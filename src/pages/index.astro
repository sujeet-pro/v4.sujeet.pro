---
import Layout from "@/layout/layout.astro"
import Profile from "@/components/profile.astro"
import Item from "@/components/item.astro"
import Link from "@/components/link.astro"
import { SITE } from "@/constants/site"
import {
  getFeaturedDeepDives,
  getFeaturedNotes,
  getPostTypeMetadata,
} from "@/utils/content-collection.utils"

// Get featured items from each section (sorted by date, newest first)
const [featuredDeepDives, featuredNotes, deepDivesMetadata, notesMetadata] = await Promise.all([
  getFeaturedDeepDives(),
  getFeaturedNotes(),
  getPostTypeMetadata("deep-dives"),
  getPostTypeMetadata("notes"),
])

// Define sections with their data from content
const sections = [
  {
    ...deepDivesMetadata,
    items: featuredDeepDives,
  },
  {
    ...notesMetadata,
    items: featuredNotes,
  },
].filter((section) => section.items.length > 0)
---

<Layout title={SITE.title} description={SITE.description} crumbs={null} pageType="default">
  <Profile />

  {
    sections.map((section) => (
      <section class="my-12 md:my-16">
        <div class="mb-6 flex items-baseline justify-between gap-4">
          <div>
            <h2 class="text-2xl font-semibold">{section.title}</h2>
            <p class="text-muted text-sm">{section.description}</p>
          </div>
          <Link href={section.href} class="nav-link shrink-0 text-sm">
            View all &rarr;
          </Link>
        </div>
        <ul class="content-list">
          {section.items.map((item) => (
            <Item item={item} />
          ))}
        </ul>
      </section>
    ))
  }
</Layout>
