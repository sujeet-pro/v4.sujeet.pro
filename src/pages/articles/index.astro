---
import ArticleCard from "@/components/cards/article-card.astro"
import SidebarNavBrowse from "@/components/nav/sidebar-nav-browse.astro"
import Layout from "@/layout/layout.astro"
import { getAllArticleCards, getCategoryHierarchy } from "@/utils/content"

const allArticles = await getAllArticleCards()
const categories = await getCategoryHierarchy()
const totalTopics = categories.reduce((sum, cat) => sum + cat.topics.length, 0)
---

<Layout
  title="All Articles"
  description="Browse all articles"
  crumbs={null}
  pageType="listing"
  hasLeftSidebar={true}
  noIndex={allArticles.length === 0}
>
  <SidebarNavBrowse slot="sidebar-left" />
  <h1 class="page-title" transition:animate="fade">Articles</h1>
  <p class="page-description">
    {allArticles.length} articles across {totalTopics} topics and {categories.length} categories.
  </p>

  <section>
    {
      allArticles.length > 0 ? (
        <ul class="article-list articles-animated">
          {allArticles.map((article, index) => (
            <div class="article-item-animated" style={`animation-delay: ${Math.min(index * 50, 400)}ms`}>
              <ArticleCard article={article} />
            </div>
          ))}
        </ul>
      ) : (
        <p class="text-muted empty-state">No articles yet. Check back soon!</p>
      )
    }
  </section>
</Layout>

<style is:global>
  @reference "tailwindcss";

  .articles-animated {
    /* Container for animated items */
  }

  .article-item-animated {
    animation: fadeInUp var(--transition-slow) forwards;
    opacity: 0;
  }

  .empty-state {
    @apply py-12 text-center;
  }
</style>
