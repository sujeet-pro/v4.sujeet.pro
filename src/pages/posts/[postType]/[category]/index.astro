---
import Item from "@/components/item.astro"
import Layout from "@/layout/layout.astro"
import { getCategoriesForType, POST_TYPE_LABELS } from "@/utils/content-categories-generic.utils"
import { getContentForType } from "@/utils/content-filters.utils"
import type { ContentItemWithoutContent, PostType } from "@/utils/content.type"

export async function getStaticPaths() {
  const postTypes: PostType[] = ["deep-dives", "notes"]
  const paths = []

  for (const postType of postTypes) {
    const items = await getContentForType(postType)
    const itemsWithoutContent = items.map(({ Content: _, ...rest }) => rest) as ContentItemWithoutContent[]
    const categories = await getCategoriesForType(postType, itemsWithoutContent)

    for (const category of categories) {
      paths.push({
        params: { postType, category: category.id },
        props: { category, postType },
      })
    }
  }

  return paths
}

const { category, postType } = Astro.props as { category: import("@/utils/content.type").CategoryWithItems; postType: PostType }
const parentLabel = POST_TYPE_LABELS[postType]
const crumbs = [{ name: parentLabel, href: `/posts/${postType}` }]
---

<Layout title={category.title} description={category.description} {crumbs} pageType="default">
  <h1 class="page-title">{category.title}</h1>
  <p class="page-description">{category.description}</p>

  {
    category.items.length > 0 ? (
      <ul class="flex flex-col">
        {category.items.map((item) => (
          <Item {item} showCategory={false} headingLevel="h2" />
        ))}
      </ul>
    ) : (
      <p class="text-muted">No content yet in this category.</p>
    )
  }
</Layout>
