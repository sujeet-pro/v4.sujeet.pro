---
import Item from "@/components/item.astro"
import Link from "@/components/link.astro"
import Layout from "@/layout/layout.astro"
import { getCategoriesForType, POST_TYPE_LABELS } from "@/utils/content-categories-generic.utils"
import { getDeepDives, getNotes } from "@/utils/content-collection.utils"
import type { ContentItemWithoutContent, PostType } from "@/utils/content.type"

export async function getStaticPaths() {
  return [
    { params: { postType: "deep-dives" } },
    { params: { postType: "notes" } },
  ]
}

const { postType } = Astro.params as { postType: PostType }

// Get items for this post type
const items = postType === "deep-dives" ? await getDeepDives() : await getNotes()
const itemsWithoutContent = items.map(({ Content: _, ...rest }) => rest) as ContentItemWithoutContent[]
const categories = await getCategoriesForType(postType, itemsWithoutContent)

const label = POST_TYPE_LABELS[postType]
const description = postType === "deep-dives"
  ? "Notes and explorations on system design, web fundamentals, and DSA"
  : "Casual technical content - design docs, programming patterns, tools, and productivity"
const crumbs = null
---

<Layout
  title={label}
  {description}
  {crumbs}
  pageType="default"
>
  <h1 class="page-title">{label}</h1>
  <p class="page-description">{description}</p>

  <!-- Categories -->
  <section class="mb-12">
    <h2 class="section-title">Browse by Category</h2>
    <div class="grid gap-3 md:grid-cols-2 lg:grid-cols-3">
      {
        categories.filter((cat) => cat.items.length > 0).map((cat) => (
          <Link href={cat.href} class="category-card">
            <h3 class="category-card-title">{cat.name}</h3>
            <p class="category-card-count">{cat.items.length} {cat.items.length === 1 ? "article" : "articles"}</p>
          </Link>
        ))
      }
    </div>
  </section>

  <!-- All Entries -->
  <section>
    <h2 class="section-title">All Articles ({items.length})</h2>
    {
      items.length > 0 ? (
        <ul class="flex flex-col">
          {items.map((item) => (
            <Item item={item} />
          ))}
        </ul>
      ) : (
        <p class="text-muted">No content yet. Check back soon!</p>
      )
    }
  </section>
</Layout>
