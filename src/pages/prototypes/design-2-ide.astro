---
// Design 2: "Developer IDE"
// Code editor aesthetic with monospace accents, dark theme, command palette feel
// IBM Plex Mono (primary) + IBM Plex Sans (UI labels)
// Catppuccin-inspired dark palette
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Design 2: Developer IDE | sujeet.pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Skip link -->
    <a href="#main-content" class="ide-skip-link">Skip to content</a>

    <!-- ================================================================
         HEADER - Terminal-inspired with tabs and file path breadcrumb
         ================================================================ -->
    <header class="ide-header">
      <div class="ide-header-inner">
        <button
          type="button"
          class="ide-header-btn ide-toggle-left"
          aria-label="Toggle file explorer"
          aria-expanded="false"
          aria-controls="sidebar-left"
        >
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 7V5a2 2 0 012-2h4l2 2h8a2 2 0 012 2v2"></path>
            <rect x="3" y="7" width="18" height="13" rx="2"></rect>
          </svg>
        </button>

        <div class="ide-tabs" role="tablist">
          <div class="ide-tab ide-tab--active" role="tab" aria-selected="true">
            <svg
              class="ide-tab-icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <span>distributed-consensus.md</span>
          </div>
          <div class="ide-tab" role="tab" aria-selected="false">
            <svg
              class="ide-tab-icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            <span>cap-theorem.md</span>
          </div>
        </div>

        <div class="ide-header-actions">
          <div class="ide-breadcrumb-path" aria-label="File path">
            <span class="ide-path-segment ide-path-home">~</span>
            <span class="ide-path-sep">/</span>
            <span class="ide-path-segment">articles</span>
            <span class="ide-path-sep">/</span>
            <span class="ide-path-segment">system-design</span>
            <span class="ide-path-sep">/</span>
            <span class="ide-path-segment ide-path-current">fundamentals</span>
          </div>

          <a href="/search" class="ide-header-btn ide-cmd-palette" aria-label="Search (Command Palette)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <span class="ide-cmd-shortcut">Ctrl+K</span>
          </a>
          <button
            type="button"
            class="ide-header-btn ide-toggle-right"
            aria-label="Toggle outline"
            aria-expanded="false"
            aria-controls="sidebar-right"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="9" y1="4" x2="9" y2="20"></line>
              <line x1="14" y1="7" x2="20" y2="7"></line>
              <line x1="14" y1="12" x2="20" y2="12"></line>
              <line x1="14" y1="17" x2="18" y2="17"></line>
              <line x1="4" y1="7" x2="7" y2="7"></line>
              <line x1="4" y1="12" x2="7" y2="12"></line>
              <line x1="4" y1="17" x2="7" y2="17"></line>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Backdrop overlay for sidebars -->
    <div class="ide-backdrop" id="sidebar-backdrop" aria-hidden="true"></div>

    <!-- ================================================================
         LEFT SIDEBAR - File Explorer style Browse Navigation
         ================================================================ -->
    <aside class="ide-sidebar ide-sidebar-left" id="sidebar-left" aria-label="Site navigation">
      <div class="ide-sidebar-header">
        <span class="ide-sidebar-title">Explorer</span>
        <button type="button" class="ide-sidebar-close" aria-label="Close file explorer">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="ide-sidebar-body">
        <!-- Merged nav links -->
        <div class="ide-nav-section">
          <a href="/" class="ide-nav-link">
            <svg
              class="ide-nav-icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path></svg
            >
            Home
          </a>
          <a href="/browse" class="ide-nav-link">
            <svg
              class="ide-nav-icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              ><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect
                x="3"
                y="14"
                width="7"
                height="7"></rect><rect x="14" y="14" width="7" height="7"></rect></svg
            >
            Browse
          </a>
          <a href="/articles" class="ide-nav-link">
            <svg
              class="ide-nav-icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              ><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path><polyline points="14 2 14 8 20 8"
              ></polyline></svg
            >
            All Articles
          </a>
          <a href="/search" class="ide-nav-link">
            <svg
              class="ide-nav-icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              ><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg
            >
            Search
          </a>
        </div>
        <div class="ide-nav-divider"></div>
        <!-- Browse: Categories > Topics > Articles (File Explorer Tree) -->
        <div class="ide-browse">
          <span class="ide-browse-label">Workspace</span>
          <!-- Category 1: System Design -->
          <details class="ide-cat" open>
            <summary class="ide-cat-summary">
              <svg
                class="ide-chevron"
                width="12"
                height="12"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
              >
              <svg
                class="ide-folder-icon"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
              >
              <span class="ide-cat-name">system-design</span>
            </summary>
            <div class="ide-cat-body">
              <details class="ide-topic" open>
                <summary class="ide-topic-summary">
                  <svg
                    class="ide-chevron"
                    width="10"
                    height="10"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
                  >
                  <svg
                    class="ide-folder-icon ide-folder-icon--sm"
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
                  >
                  fundamentals <span class="ide-count">19</span>
                </summary>
                <ul class="ide-article-list">
                  <li>
                    <a href="#" class="ide-article-link ide-article-link--active"
                      ><span class="ide-file-icon">M</span>distributed-consensus.md</a
                    >
                  </li>
                  <li><a href="#" class="ide-article-link"><span class="ide-file-icon">M</span>cap-theorem.md</a></li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">M</span>time-and-ordering.md</a>
                  </li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">M</span>load-balancers.md</a>
                  </li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">M</span>caching-strategies.md</a>
                  </li>
                </ul>
              </details>
              <details class="ide-topic">
                <summary class="ide-topic-summary">
                  <svg
                    class="ide-chevron"
                    width="10"
                    height="10"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
                  >
                  <svg
                    class="ide-folder-icon ide-folder-icon--sm"
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
                  >
                  design-problems <span class="ide-count">24</span>
                </summary>
                <ul class="ide-article-list">
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">M</span>design-youtube.md</a>
                  </li>
                  <li><a href="#" class="ide-article-link"><span class="ide-file-icon">M</span>design-uber.md</a></li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">M</span>design-chat-system.md</a>
                  </li>
                </ul>
              </details>
            </div>
          </details>
          <!-- Category 2: Frontend Engineering -->
          <details class="ide-cat">
            <summary class="ide-cat-summary">
              <svg
                class="ide-chevron"
                width="12"
                height="12"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
              >
              <svg
                class="ide-folder-icon"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
              >
              <span class="ide-cat-name">frontend-engineering</span>
            </summary>
            <div class="ide-cat-body">
              <details class="ide-topic">
                <summary class="ide-topic-summary">
                  <svg
                    class="ide-chevron"
                    width="10"
                    height="10"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
                  >
                  <svg
                    class="ide-folder-icon ide-folder-icon--sm"
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
                  >
                  react-patterns <span class="ide-count">8</span>
                </summary>
                <ul class="ide-article-list">
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">T</span>component-composition.md</a
                    >
                  </li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">T</span>state-management.md</a>
                  </li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">T</span>performance-hooks.md</a>
                  </li>
                </ul>
              </details>
              <details class="ide-topic">
                <summary class="ide-topic-summary">
                  <svg
                    class="ide-chevron"
                    width="10"
                    height="10"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
                  >
                  <svg
                    class="ide-folder-icon ide-folder-icon--sm"
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
                  >
                  performance <span class="ide-count">6</span>
                </summary>
                <ul class="ide-article-list">
                  <li><a href="#" class="ide-article-link"><span class="ide-file-icon">T</span>web-vitals.md</a></li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">T</span>bundle-optimization.md</a>
                  </li>
                </ul>
              </details>
            </div>
          </details>
          <!-- Category 3: Programming Patterns -->
          <details class="ide-cat">
            <summary class="ide-cat-summary">
              <svg
                class="ide-chevron"
                width="12"
                height="12"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
              >
              <svg
                class="ide-folder-icon"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
              >
              <span class="ide-cat-name">programming-patterns</span>
            </summary>
            <div class="ide-cat-body">
              <details class="ide-topic">
                <summary class="ide-topic-summary">
                  <svg
                    class="ide-chevron"
                    width="10"
                    height="10"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"><polyline points="9 6 15 12 9 18"></polyline></svg
                  >
                  <svg
                    class="ide-folder-icon ide-folder-icon--sm"
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    ><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"></path></svg
                  >
                  algorithms <span class="ide-count">12</span>
                </summary>
                <ul class="ide-article-list">
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">P</span>sorting-algorithms.md</a>
                  </li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">P</span>graph-traversal.md</a>
                  </li>
                  <li>
                    <a href="#" class="ide-article-link"><span class="ide-file-icon">P</span>dynamic-programming.md</a>
                  </li>
                </ul>
              </details>
            </div>
          </details>
        </div>
      </nav>
    </aside>

    <!-- ================================================================
         RIGHT SIDEBAR - Outline / Symbol Navigator
         ================================================================ -->
    <aside class="ide-sidebar ide-sidebar-right" id="sidebar-right" aria-label="Table of contents">
      <div class="ide-sidebar-header">
        <span class="ide-sidebar-title">Outline</span>
        <button type="button" class="ide-sidebar-close" aria-label="Close outline">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="ide-sidebar-body ide-toc-nav">
        <ol class="ide-toc-list">
          <li>
            <a href="#overview" class="ide-toc-link ide-toc-h2"><span class="ide-toc-symbol">H2</span>Overview</a>
          </li>
          <li>
            <a href="#the-consensus-problem" class="ide-toc-link ide-toc-h2"
              ><span class="ide-toc-symbol">H2</span>The Consensus Problem</a
            >
            <ol class="ide-toc-sublist">
              <li>
                <a href="#why-consensus-matters" class="ide-toc-link ide-toc-h3"
                  ><span class="ide-toc-symbol ide-toc-symbol--h3">H3</span>Why Consensus Matters</a
                >
              </li>
              <li>
                <a href="#flp-impossibility" class="ide-toc-link ide-toc-h3"
                  ><span class="ide-toc-symbol ide-toc-symbol--h3">H3</span>FLP Impossibility</a
                >
              </li>
            </ol>
          </li>
          <li>
            <a href="#paxos-algorithm" class="ide-toc-link ide-toc-h2"
              ><span class="ide-toc-symbol">H2</span>Paxos Algorithm</a
            >
            <ol class="ide-toc-sublist">
              <li>
                <a href="#paxos-phases" class="ide-toc-link ide-toc-h3"
                  ><span class="ide-toc-symbol ide-toc-symbol--h3">H3</span>Phases of Paxos</a
                >
              </li>
              <li>
                <a href="#multi-paxos" class="ide-toc-link ide-toc-h3"
                  ><span class="ide-toc-symbol ide-toc-symbol--h3">H3</span>Multi-Paxos</a
                >
              </li>
            </ol>
          </li>
          <li>
            <a href="#raft-consensus" class="ide-toc-link ide-toc-h2"
              ><span class="ide-toc-symbol">H2</span>Raft Consensus</a
            >
            <ol class="ide-toc-sublist">
              <li>
                <a href="#leader-election" class="ide-toc-link ide-toc-h3"
                  ><span class="ide-toc-symbol ide-toc-symbol--h3">H3</span>Leader Election</a
                >
              </li>
              <li>
                <a href="#log-replication" class="ide-toc-link ide-toc-h3"
                  ><span class="ide-toc-symbol ide-toc-symbol--h3">H3</span>Log Replication</a
                >
              </li>
            </ol>
          </li>
          <li>
            <a href="#comparison" class="ide-toc-link ide-toc-h2"><span class="ide-toc-symbol">H2</span>Comparison</a>
          </li>
          <li>
            <a href="#appendix" class="ide-toc-link ide-toc-h2"><span class="ide-toc-symbol">H2</span>Appendix</a>
          </li>
        </ol>
      </nav>
    </aside>

    <!-- ================================================================
         MAIN CONTENT - with line numbers gutter
         ================================================================ -->
    <main id="main-content" class="ide-main">
      <article class="ide-article">
        <!-- Breadcrumb (terminal-style) -->
        <nav class="ide-breadcrumb" aria-label="Breadcrumb">
          <span class="ide-breadcrumb-prompt">$</span>
          <a href="/articles">articles</a>
          <span class="ide-breadcrumb-sep">/</span>
          <a href="#">system-design</a>
          <span class="ide-breadcrumb-sep">/</span>
          <a href="#">fundamentals</a>
        </nav>

        <!-- Article Header -->
        <header class="ide-article-header">
          <div class="ide-article-meta-top">
            <span class="ide-tag ide-tag--category">system-design</span>
            <span class="ide-tag ide-tag--date">
              <time datetime="2024-11-15">2024-11-15</time>
            </span>
            <span class="ide-tag ide-tag--topic">fundamentals</span>
          </div>
          <h1 class="ide-article-title">
            <span class="ide-title-hash"># </span>Understanding Distributed Consensus Algorithms
          </h1>
          <p class="ide-article-subtitle">
            How systems like Paxos and Raft enable multiple nodes to agree on a single value, even in the presence of
            failures.
          </p>
          <div class="ide-article-meta-bottom">
            <span class="ide-meta-item"
              ><span class="ide-meta-key">read_time:</span> <span class="ide-meta-val">18 min</span></span
            >
            <span class="ide-meta-item"
              ><span class="ide-meta-key">words:</span> <span class="ide-meta-val">3,450</span></span
            >
            <span class="ide-meta-item"
              ><span class="ide-meta-key">topic:</span> <span class="ide-meta-val">fundamentals</span></span
            >
          </div>
        </header>

        <div class="ide-rule"></div>

        <!-- Article Body with line numbers -->
        <div class="ide-prose">
          <div class="ide-line-numbers" aria-hidden="true"></div>
          <div class="ide-content-area">
            <h2 id="overview">Overview</h2>
            <p>
              Distributed consensus is the cornerstone of reliable distributed systems. When multiple computers need to
              work together, they must agree on shared state despite network partitions, message delays, and node
              failures. This article explores the fundamental algorithms that make this possible.
            </p>
            <p>
              The challenge of achieving consensus has been studied extensively since the 1980s. From Leslie Lamport's
              pioneering work on Paxos to Diego Ongaro's more approachable Raft algorithm, the field has evolved to
              provide practical solutions for real-world systems like etcd, ZooKeeper, and CockroachDB.
            </p>

            <blockquote>
              <p>
                "A distributed system is one in which the failure of a computer you didn't even know existed can render
                your own computer unusable."
              </p>
              <cite>&mdash; Leslie Lamport</cite>
            </blockquote>

            <h2 id="the-consensus-problem">The Consensus Problem</h2>
            <p>
              At its core, the consensus problem requires a group of processes to agree on a single value. This sounds
              simple, but becomes remarkably difficult when processes can fail and messages can be lost or delayed.
            </p>

            <h3 id="why-consensus-matters">Why Consensus Matters</h3>
            <p>
              Consensus is essential for many distributed systems primitives including leader election, atomic
              broadcast, state machine replication, and distributed locking.
            </p>
            <ul>
              <li><strong>Leader Election</strong> &mdash; Selecting a single coordinator among replicas</li>
              <li><strong>State Machine Replication</strong> &mdash; Keeping multiple copies of data consistent</li>
              <li><strong>Distributed Transactions</strong> &mdash; Ensuring atomicity across partitions</li>
              <li><strong>Configuration Management</strong> &mdash; Agreeing on cluster membership</li>
            </ul>

            <h3 id="flp-impossibility">FLP Impossibility</h3>
            <p>
              The Fischer, Lynch, and Paterson impossibility result (1985) proves that no deterministic algorithm can
              guarantee consensus in an asynchronous system where even one process may crash. This foundational result
              shapes how all practical consensus algorithms are designed.
            </p>

            <table>
              <thead>
                <tr>
                  <th>Property</th>
                  <th>Description</th>
                  <th>Implication</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Agreement</td>
                  <td>All correct processes decide the same value</td>
                  <td>No split-brain scenarios</td>
                </tr>
                <tr>
                  <td>Validity</td>
                  <td>The decided value was proposed by some process</td>
                  <td>No fabricated values</td>
                </tr>
                <tr>
                  <td>Termination</td>
                  <td>Every correct process eventually decides</td>
                  <td>No infinite waiting</td>
                </tr>
              </tbody>
            </table>

            <h2 id="paxos-algorithm">Paxos Algorithm</h2>
            <p>
              Paxos, introduced by Leslie Lamport in 1989, was the first practical consensus algorithm. Despite its
              reputation for difficulty, the core idea is elegant: a proposer must convince a majority of acceptors
              before a value is chosen.
            </p>

            <h3 id="paxos-phases">Phases of Paxos</h3>
            <p>The basic Paxos protocol operates in two phases:</p>
            <ol>
              <li>
                <strong>Prepare Phase</strong> &mdash; A proposer sends a prepare request with a unique proposal number to
                a majority of acceptors.
              </li>
              <li>
                <strong>Accept Phase</strong> &mdash; If a majority responds, the proposer sends an accept request with the
                value.
              </li>
            </ol>

            <pre><code><span class="ide-syn-comment">// Simplified Paxos proposer logic</span>
<span class="ide-syn-keyword">async function</span> <span class="ide-syn-fn">propose</span>(<span class="ide-syn-param">value</span>: <span class="ide-syn-type">string</span>, <span class="ide-syn-param">acceptors</span>: <span class="ide-syn-type">Acceptor</span>[]) {'{'}
  <span class="ide-syn-keyword">const</span> proposalId = <span class="ide-syn-fn">generateUniqueId</span>();
  <span class="ide-syn-keyword">const</span> majority = <span class="ide-syn-type">Math</span>.<span class="ide-syn-fn">floor</span>(acceptors.length / <span class="ide-syn-num">2</span>) + <span class="ide-syn-num">1</span>;

  <span class="ide-syn-comment">// Phase 1: Prepare</span>
  <span class="ide-syn-keyword">const</span> promises = <span class="ide-syn-keyword">await</span> <span class="ide-syn-type">Promise</span>.<span class="ide-syn-fn">all</span>(
    acceptors.<span class="ide-syn-fn">map</span>(<span class="ide-syn-param">a</span> => a.<span class="ide-syn-fn">prepare</span>(proposalId))
  );
  <span class="ide-syn-keyword">const</span> accepted = promises.<span class="ide-syn-fn">filter</span>(<span class="ide-syn-param">p</span> => p.ok);

  <span class="ide-syn-keyword">if</span> (accepted.length {'<'} majority) {'{'}
    <span class="ide-syn-keyword">throw new</span> <span class="ide-syn-type">Error</span>(<span class="ide-syn-str">'Failed to get majority in prepare phase'</span>);
  {'}'}

  <span class="ide-syn-comment">// Phase 2: Accept</span>
  <span class="ide-syn-keyword">const</span> finalValue = <span class="ide-syn-fn">getHighestAcceptedValue</span>(accepted) || value;
  <span class="ide-syn-keyword">const</span> acks = <span class="ide-syn-keyword">await</span> <span class="ide-syn-type">Promise</span>.<span class="ide-syn-fn">all</span>(
    acceptors.<span class="ide-syn-fn">map</span>(<span class="ide-syn-param">a</span> => a.<span class="ide-syn-fn">accept</span>(proposalId, finalValue))
  );

  <span class="ide-syn-keyword">return</span> acks.<span class="ide-syn-fn">filter</span>(<span class="ide-syn-param">a</span> => a.ok).length >= majority;
{'}'}</code></pre>

            <h3 id="multi-paxos">Multi-Paxos</h3>
            <p>
              Basic Paxos requires two round-trips for each consensus decision. Multi-Paxos optimizes this by electing a
              stable leader that can skip the prepare phase for subsequent proposals, reducing latency to a single
              round-trip in the common case.
            </p>

            <h2 id="raft-consensus">Raft Consensus</h2>
            <p>
              Raft was designed by Diego Ongaro and John Ousterhout in 2014 as a more understandable alternative to
              Paxos. It decomposes consensus into three sub-problems: leader election, log replication, and safety.
            </p>

            <h3 id="leader-election">Leader Election</h3>
            <p>
              Raft uses randomized timeouts to trigger elections. When a follower doesn't hear from a leader within its
              timeout period, it becomes a candidate and requests votes from other nodes.
            </p>

            <h3 id="log-replication">Log Replication</h3>
            <p>
              Once elected, the leader accepts client requests and replicates log entries to followers. An entry is
              considered committed when a majority of nodes have acknowledged it.
            </p>

            <figure>
              <div class="ide-placeholder-diagram" role="img" aria-label="Raft log replication diagram">
                <span>Raft Log Replication Flow</span>
                <div class="ide-diagram-nodes">
                  <div class="ide-diagram-node ide-diagram-leader">Leader</div>
                  <div class="ide-diagram-arrows">
                    <span>&rarr;</span><span>&rarr;</span><span>&rarr;</span>
                  </div>
                  <div class="ide-diagram-node">Follower 1</div>
                  <div class="ide-diagram-node">Follower 2</div>
                  <div class="ide-diagram-node">Follower 3</div>
                </div>
              </div>
              <figcaption>
                Figure 1: Leader replicates log entries to all followers. Entry is committed after majority
                acknowledgment.
              </figcaption>
            </figure>

            <h2 id="comparison">Comparison</h2>
            <p>
              While both Paxos and Raft solve the same fundamental problem, they differ significantly in their approach
              to understandability, implementation complexity, and operational behavior.
            </p>

            <table>
              <thead>
                <tr>
                  <th>Aspect</th>
                  <th>Paxos</th>
                  <th>Raft</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Understandability</td>
                  <td>Complex, academic</td>
                  <td>Designed for clarity</td>
                </tr>
                <tr>
                  <td>Leader requirement</td>
                  <td>Optional (Multi-Paxos)</td>
                  <td>Required (strong leader)</td>
                </tr>
                <tr>
                  <td>Log ordering</td>
                  <td>Allows gaps</td>
                  <td>Strict sequential</td>
                </tr>
                <tr>
                  <td>Used in</td>
                  <td>Chubby, Spanner</td>
                  <td>etcd, CockroachDB</td>
                </tr>
              </tbody>
            </table>

            <h2 id="appendix">Appendix</h2>
            <h3>Prerequisites</h3>
            <ul>
              <li>Understanding of distributed systems fundamentals</li>
              <li>Familiarity with client-server architecture</li>
              <li>Basic knowledge of fault tolerance concepts</li>
            </ul>
            <h3>Summary</h3>
            <p>
              Distributed consensus enables reliable systems by allowing multiple nodes to agree on shared state. Paxos
              pioneered the field but is complex to understand. Raft provides equivalent guarantees with a clearer
              structure. Modern systems like etcd and CockroachDB rely on Raft for their consensus layer.
            </p>
            <h3>References</h3>
            <ul>
              <li>Lamport, L. "The Part-Time Parliament" (1998)</li>
              <li>Ongaro, D. & Ousterhout, J. "In Search of an Understandable Consensus Algorithm" (2014)</li>
              <li>
                Fischer, M., Lynch, N., Paterson, M. "Impossibility of Distributed Consensus with One Faulty Process"
                (1985)
              </li>
            </ul>
          </div>
        </div>

        <!-- Article Navigation -->
        <div class="ide-rule"></div>
        <nav class="ide-article-nav" aria-label="Article navigation">
          <a href="#" class="ide-nav-prev">
            <span class="ide-nav-label">&lt;-- prev</span>
            <span class="ide-nav-title">cap-theorem.md</span>
          </a>
          <a href="#" class="ide-nav-next">
            <span class="ide-nav-label">next --&gt;</span>
            <span class="ide-nav-title">time-and-ordering.md</span>
          </a>
        </nav>
      </article>
    </main>

    <!-- ================================================================
         STATUS BAR (VS Code style)
         ================================================================ -->
    <footer class="ide-statusbar" aria-label="Status bar">
      <div class="ide-statusbar-left">
        <span class="ide-statusbar-item ide-statusbar-branch">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            ><line x1="6" y1="3" x2="6" y2="15"></line><circle cx="18" cy="6" r="3"></circle><circle
              cx="6"
              cy="18"
              r="3"></circle><path d="M18 9a9 9 0 01-9 9"></path></svg
          >
          main
        </span>
        <span class="ide-statusbar-item">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            ><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line
              x1="12"
              y1="16"
              x2="12.01"
              y2="16"></line></svg
          >
          0 problems
        </span>
      </div>
      <div class="ide-statusbar-right">
        <span class="ide-statusbar-item ide-statusbar-progress">
          <span class="ide-progress-label">Reading:</span>
          <span class="ide-progress-bar"><span class="ide-progress-fill" id="reading-progress"></span></span>
          <span class="ide-progress-pct" id="reading-pct">0%</span>
        </span>
        <span class="ide-statusbar-item">Ln 1, Col 1</span>
        <span class="ide-statusbar-item">UTF-8</span>
        <span class="ide-statusbar-item">Markdown</span>
        <span class="ide-statusbar-item ide-statusbar-words">3,450 words</span>
      </div>
    </footer>
  </body>
</html>

<style is:global>
  /* ================================================================
     DESIGN 2: DEVELOPER IDE
     Catppuccin-inspired dark theme, monospace typography,
     code editor chrome, terminal aesthetics
     ================================================================ */

  /* --- Reset --- */
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  /* --- Design Tokens --- */
  :root {
    /* Catppuccin Mocha base */
    --ide-bg: #1e1e2e;
    --ide-bg-alt: #181825;
    --ide-bg-elevated: #24243a;
    --ide-bg-surface: #313244;
    --ide-bg-highlight: rgba(137, 180, 250, 0.08);
    --ide-bg-active-line: rgba(137, 180, 250, 0.06);

    /* Text */
    --ide-text: #cdd6f4;
    --ide-text-secondary: #bac2de;
    --ide-text-muted: #6c7086;
    --ide-text-subtle: #585b70;

    /* Accent colors (syntax highlighting palette) */
    --ide-blue: #89b4fa;
    --ide-pink: #f38ba8;
    --ide-green: #a6e3a1;
    --ide-peach: #fab387;
    --ide-yellow: #f9e2af;
    --ide-lavender: #b4befe;
    --ide-teal: #94e2d5;
    --ide-mauve: #cba6f7;
    --ide-red: #f38ba8;
    --ide-sky: #89dcfe;

    /* Functional */
    --ide-accent: #89b4fa;
    --ide-accent-hover: #b4befe;
    --ide-border: #313244;
    --ide-border-subtle: #2a2a3e;
    --ide-gutter: #45475a;
    --ide-line-number: #45475a;
    --ide-selection: rgba(137, 180, 250, 0.15);

    /* Fonts */
    --ide-font-mono: "IBM Plex Mono", "JetBrains Mono", "Fira Code", monospace;
    --ide-font-sans: "IBM Plex Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;

    /* Layout */
    --ide-content-width: 760px;
    --ide-sidebar-width: 280px;
    --ide-header-height: 40px;
    --ide-statusbar-height: 28px;
    --ide-gutter-width: 52px;
    --ide-transition: 200ms cubic-bezier(0.4, 0, 0.2, 1);
    --ide-transition-fast: 120ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* --- Base --- */
  html {
    scroll-behavior: smooth;
    scroll-padding-top: calc(var(--ide-header-height) + 1.5rem);
  }
  body {
    font-family: var(--ide-font-mono);
    font-size: 14px;
    line-height: 1.7;
    color: var(--ide-text);
    background: var(--ide-bg);
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* --- Skip Link --- */
  .ide-skip-link {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 200;
    padding: 6px 14px;
    background: var(--ide-accent);
    color: var(--ide-bg);
    font-family: var(--ide-font-mono);
    font-size: 12px;
    text-decoration: none;
    font-weight: 600;
    transform: translateY(-100%);
    transition: transform var(--ide-transition-fast);
  }
  .ide-skip-link:focus {
    transform: translateY(0);
  }

  /* ================================================================
     HEADER - Tab bar with terminal path
     ================================================================ */
  .ide-header {
    position: sticky;
    top: 0;
    z-index: 50;
    height: var(--ide-header-height);
    background: var(--ide-bg-alt);
    border-bottom: 1px solid var(--ide-border);
  }
  .ide-header-inner {
    display: flex;
    align-items: center;
    height: 100%;
    padding: 0;
  }

  /* Tabs */
  .ide-tabs {
    display: flex;
    align-items: stretch;
    height: 100%;
    flex-shrink: 0;
  }
  .ide-tab {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 0 16px;
    font-family: var(--ide-font-mono);
    font-size: 12px;
    color: var(--ide-text-muted);
    border-right: 1px solid var(--ide-border);
    cursor: pointer;
    transition: all var(--ide-transition-fast);
    white-space: nowrap;
  }
  .ide-tab:hover {
    color: var(--ide-text-secondary);
    background: var(--ide-bg);
  }
  .ide-tab--active {
    color: var(--ide-text);
    background: var(--ide-bg);
    border-bottom: 2px solid var(--ide-accent);
    margin-bottom: -1px;
  }
  .ide-tab-icon {
    flex-shrink: 0;
    color: var(--ide-blue);
  }
  .ide-tab--active .ide-tab-icon {
    color: var(--ide-blue);
  }

  /* Breadcrumb path in header */
  .ide-breadcrumb-path {
    display: none;
    align-items: center;
    gap: 2px;
    font-family: var(--ide-font-mono);
    font-size: 12px;
    color: var(--ide-text-muted);
    padding: 0 12px;
    white-space: nowrap;
    overflow: hidden;
  }
  @media (min-width: 768px) {
    .ide-breadcrumb-path {
      display: flex;
    }
  }
  .ide-path-sep {
    color: var(--ide-text-subtle);
    margin: 0 1px;
  }
  .ide-path-segment {
    color: var(--ide-text-muted);
  }
  .ide-path-home {
    color: var(--ide-green);
  }
  .ide-path-current {
    color: var(--ide-text);
  }

  /* Header actions */
  .ide-header-actions {
    display: flex;
    align-items: center;
    margin-left: auto;
    height: 100%;
  }
  .ide-header-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--ide-text-muted);
    transition: all var(--ide-transition-fast);
    flex-shrink: 0;
  }
  .ide-header-btn:hover {
    color: var(--ide-text);
    background: var(--ide-bg-highlight);
  }
  .ide-header-btn[aria-expanded="true"] {
    color: var(--ide-accent);
    background: var(--ide-bg-highlight);
  }

  /* Command palette search button */
  .ide-cmd-palette {
    gap: 8px;
    width: auto;
    padding: 0 12px;
    text-decoration: none;
  }
  .ide-cmd-shortcut {
    font-family: var(--ide-font-mono);
    font-size: 10px;
    padding: 2px 6px;
    background: var(--ide-bg-surface);
    border: 1px solid var(--ide-border);
    border-radius: 3px;
    color: var(--ide-text-muted);
  }
  @media (max-width: 640px) {
    .ide-cmd-shortcut {
      display: none;
    }
    .ide-cmd-palette {
      width: 40px;
      padding: 0;
    }
  }

  /* ================================================================
     BACKDROP
     ================================================================ */
  .ide-backdrop {
    position: fixed;
    inset: 0;
    z-index: 59;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--ide-transition);
  }
  .ide-backdrop.is-visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* ================================================================
     SIDEBARS (shared base)
     ================================================================ */
  .ide-sidebar {
    position: fixed;
    top: 0;
    z-index: 60;
    width: var(--ide-sidebar-width);
    height: 100vh;
    height: 100dvh;
    background: var(--ide-bg-alt);
    display: flex;
    flex-direction: column;
    transition: transform var(--ide-transition);
    overflow: hidden;
  }
  .ide-sidebar-left {
    left: 0;
    border-right: 1px solid var(--ide-border);
    transform: translateX(-100%);
  }
  .ide-sidebar-left.is-open {
    transform: translateX(0);
  }

  .ide-sidebar-right {
    right: 0;
    border-left: 1px solid var(--ide-border);
    transform: translateX(100%);
  }
  .ide-sidebar-right.is-open {
    transform: translateX(0);
  }

  .ide-sidebar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 12px;
    height: var(--ide-header-height);
    border-bottom: 1px solid var(--ide-border);
    flex-shrink: 0;
    background: var(--ide-bg-alt);
  }
  .ide-sidebar-title {
    font-family: var(--ide-font-sans);
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--ide-text-muted);
  }
  .ide-sidebar-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--ide-text-muted);
    border-radius: 4px;
    transition: all var(--ide-transition-fast);
  }
  .ide-sidebar-close:hover {
    background: var(--ide-bg-highlight);
    color: var(--ide-text);
  }
  .ide-sidebar-body {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
    /* Custom scrollbar for dark theme */
    scrollbar-width: thin;
    scrollbar-color: var(--ide-gutter) transparent;
  }
  .ide-sidebar-body::-webkit-scrollbar {
    width: 6px;
  }
  .ide-sidebar-body::-webkit-scrollbar-track {
    background: transparent;
  }
  .ide-sidebar-body::-webkit-scrollbar-thumb {
    background: var(--ide-gutter);
    border-radius: 3px;
  }

  /* --- Nav Section (file explorer links) --- */
  .ide-nav-section {
    padding: 4px 8px;
  }
  .ide-nav-link {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 8px;
    font-family: var(--ide-font-mono);
    font-size: 12px;
    font-weight: 400;
    color: var(--ide-text-secondary);
    text-decoration: none;
    border-radius: 4px;
    transition: all var(--ide-transition-fast);
  }
  .ide-nav-link:hover {
    background: var(--ide-bg-highlight);
    color: var(--ide-text);
  }
  .ide-nav-icon {
    flex-shrink: 0;
    color: var(--ide-text-muted);
  }
  .ide-nav-divider {
    height: 1px;
    margin: 6px 12px;
    background: var(--ide-border);
  }

  /* --- Browse Section (File Explorer Tree) --- */
  .ide-browse {
    padding: 0 4px;
  }
  .ide-browse-label {
    display: block;
    padding: 6px 12px 4px;
    font-family: var(--ide-font-sans);
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--ide-text-muted);
  }

  /* Category accordion (folder) */
  .ide-cat {
    border: none;
  }
  .ide-cat-summary {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    cursor: pointer;
    list-style: none;
    border-radius: 4px;
    transition: background var(--ide-transition-fast);
  }
  .ide-cat-summary::-webkit-details-marker {
    display: none;
  }
  .ide-cat-summary:hover {
    background: var(--ide-bg-highlight);
  }
  .ide-cat-name {
    font-family: var(--ide-font-mono);
    font-size: 13px;
    font-weight: 500;
    color: var(--ide-text-secondary);
  }
  .ide-chevron {
    color: var(--ide-text-muted);
    transition: transform var(--ide-transition);
    flex-shrink: 0;
  }
  .ide-cat[open] > .ide-cat-summary .ide-chevron,
  .ide-topic[open] > .ide-topic-summary .ide-chevron {
    transform: rotate(90deg);
  }
  .ide-folder-icon {
    color: var(--ide-peach);
    flex-shrink: 0;
  }
  .ide-folder-icon--sm {
    color: var(--ide-yellow);
  }
  .ide-cat[open] > .ide-cat-summary .ide-folder-icon {
    color: var(--ide-peach);
  }
  .ide-cat-body {
    padding: 0 0 2px 12px;
    border-left: 1px solid var(--ide-border-subtle);
    margin-left: 10px;
  }

  /* Topic accordion (subfolder) */
  .ide-topic {
    border: none;
  }
  .ide-topic-summary {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    cursor: pointer;
    list-style: none;
    border-radius: 4px;
    font-family: var(--ide-font-mono);
    font-size: 12px;
    font-weight: 400;
    color: var(--ide-text-muted);
    transition: all var(--ide-transition-fast);
  }
  .ide-topic-summary::-webkit-details-marker {
    display: none;
  }
  .ide-topic-summary:hover {
    background: var(--ide-bg-highlight);
    color: var(--ide-text-secondary);
  }
  .ide-count {
    font-size: 10px;
    color: var(--ide-text-subtle);
    background: var(--ide-bg-surface);
    padding: 0 5px;
    border-radius: 3px;
    margin-left: auto;
    font-family: var(--ide-font-mono);
  }

  /* Article links in sidebar (files) */
  .ide-article-list {
    list-style: none;
    padding: 1px 0 1px 12px;
    border-left: 1px solid var(--ide-border-subtle);
    margin-left: 10px;
  }
  .ide-article-link {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 3px 8px;
    font-family: var(--ide-font-mono);
    font-size: 12px;
    color: var(--ide-text-muted);
    text-decoration: none;
    border-radius: 4px;
    transition: all var(--ide-transition-fast);
  }
  .ide-article-link:hover {
    color: var(--ide-text);
    background: var(--ide-bg-highlight);
  }
  .ide-file-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    font-size: 9px;
    font-weight: 700;
    border-radius: 3px;
    flex-shrink: 0;
    background: var(--ide-bg-surface);
    color: var(--ide-blue);
  }
  .ide-article-link--active {
    color: var(--ide-text) !important;
    background: var(--ide-bg-active-line);
    border-left: 2px solid var(--ide-accent);
    margin-left: -2px;
  }
  .ide-article-link--active .ide-file-icon {
    background: var(--ide-accent);
    color: var(--ide-bg);
  }

  /* --- TOC in right sidebar (Outline / Symbol Navigator) --- */
  .ide-toc-nav {
    padding: 4px 0;
  }
  .ide-toc-list,
  .ide-toc-sublist {
    list-style: none;
  }
  .ide-toc-list {
    padding: 0;
  }
  .ide-toc-sublist {
    padding: 0 0 2px 8px;
    margin-left: 16px;
    border-left: 1px solid var(--ide-border-subtle);
  }
  .ide-toc-link {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 4px 12px;
    font-family: var(--ide-font-mono);
    text-decoration: none;
    border-radius: 4px;
    transition: all var(--ide-transition-fast);
  }
  .ide-toc-h2 {
    font-size: 12px;
    font-weight: 500;
    color: var(--ide-text-secondary);
  }
  .ide-toc-h3 {
    font-size: 11px;
    color: var(--ide-text-muted);
  }
  .ide-toc-link:hover {
    background: var(--ide-bg-highlight);
    color: var(--ide-text);
  }
  .ide-toc-symbol {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 9px;
    font-weight: 700;
    min-width: 22px;
    height: 16px;
    background: rgba(137, 180, 250, 0.15);
    color: var(--ide-blue);
    border-radius: 3px;
    flex-shrink: 0;
    font-family: var(--ide-font-mono);
  }
  .ide-toc-symbol--h3 {
    background: rgba(166, 227, 161, 0.12);
    color: var(--ide-green);
  }

  /* ================================================================
     MAIN CONTENT - Always Centered, with gutter line
     ================================================================ */
  .ide-main {
    max-width: var(--ide-content-width);
    margin: 0 auto;
    padding: 0 24px calc(var(--ide-statusbar-height) + 60px);
    flex: 1;
    position: relative;
  }

  /* Gutter vertical line */
  .ide-main::before {
    content: "";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 20px;
    width: 1px;
    background: var(--ide-border-subtle);
    pointer-events: none;
  }
  @media (max-width: 640px) {
    .ide-main::before {
      display: none;
    }
  }

  /* --- Breadcrumb (terminal-style) --- */
  .ide-breadcrumb {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 20px 0 8px;
    font-family: var(--ide-font-mono);
    font-size: 12px;
  }
  .ide-breadcrumb-prompt {
    color: var(--ide-green);
    font-weight: 600;
    margin-right: 4px;
  }
  .ide-breadcrumb a {
    color: var(--ide-text-muted);
    text-decoration: none;
    transition: color var(--ide-transition-fast);
  }
  .ide-breadcrumb a:hover {
    color: var(--ide-accent);
  }
  .ide-breadcrumb-sep {
    color: var(--ide-text-subtle);
  }

  /* --- Article Header --- */
  .ide-article-header {
    padding: 24px 0 0;
  }
  .ide-article-meta-top {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }
  .ide-tag {
    font-family: var(--ide-font-mono);
    font-size: 11px;
    font-weight: 500;
    padding: 2px 10px;
    border-radius: 3px;
    white-space: nowrap;
  }
  .ide-tag--category {
    background: rgba(137, 180, 250, 0.12);
    color: var(--ide-blue);
  }
  .ide-tag--date {
    background: rgba(166, 227, 161, 0.12);
    color: var(--ide-green);
  }
  .ide-tag--topic {
    background: rgba(250, 179, 135, 0.12);
    color: var(--ide-peach);
  }

  .ide-article-title {
    font-family: var(--ide-font-mono);
    font-size: clamp(22px, 4vw, 34px);
    font-weight: 700;
    line-height: 1.3;
    color: var(--ide-text);
    letter-spacing: -0.02em;
    margin-bottom: 14px;
  }
  .ide-title-hash {
    color: var(--ide-text-subtle);
    font-weight: 300;
  }
  .ide-article-subtitle {
    font-family: var(--ide-font-mono);
    font-size: 15px;
    line-height: 1.6;
    color: var(--ide-text-muted);
    max-width: 640px;
    margin-bottom: 16px;
  }
  .ide-article-meta-bottom {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 16px;
    font-family: var(--ide-font-mono);
    font-size: 12px;
  }
  .ide-meta-item {
    color: var(--ide-text-muted);
  }
  .ide-meta-key {
    color: var(--ide-mauve);
  }
  .ide-meta-val {
    color: var(--ide-text-secondary);
  }

  /* --- Rule --- */
  .ide-rule {
    height: 1px;
    margin: 24px 0;
    background: var(--ide-border);
  }

  /* --- Prose Content --- */
  .ide-prose {
    padding: 16px 0 48px;
    position: relative;
  }

  /* Decorative line numbers */
  .ide-line-numbers {
    position: absolute;
    top: 16px;
    left: -36px;
    width: 28px;
    font-family: var(--ide-font-mono);
    font-size: 11px;
    line-height: 1.7;
    color: var(--ide-line-number);
    text-align: right;
    user-select: none;
    pointer-events: none;
  }
  @media (max-width: 768px) {
    .ide-line-numbers {
      display: none;
    }
  }

  .ide-content-area {
    position: relative;
  }

  .ide-prose h2 {
    font-family: var(--ide-font-mono);
    font-size: clamp(20px, 3vw, 26px);
    font-weight: 700;
    line-height: 1.35;
    color: var(--ide-blue);
    margin: 48px 0 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--ide-border-subtle);
    letter-spacing: -0.01em;
  }
  .ide-prose h2::before {
    content: "## ";
    color: var(--ide-text-subtle);
    font-weight: 300;
  }
  .ide-prose h3 {
    font-family: var(--ide-font-mono);
    font-size: clamp(16px, 2.2vw, 20px);
    font-weight: 600;
    line-height: 1.4;
    color: var(--ide-lavender);
    margin: 36px 0 10px;
  }
  .ide-prose h3::before {
    content: "### ";
    color: var(--ide-text-subtle);
    font-weight: 300;
  }
  .ide-prose p {
    margin-bottom: 20px;
    font-size: 14px;
    color: var(--ide-text-secondary);
    line-height: 1.8;
  }
  .ide-prose a {
    color: var(--ide-accent);
    text-decoration: none;
    border-bottom: 1px dashed var(--ide-accent);
    transition: border-color var(--ide-transition-fast);
  }
  .ide-prose a:hover {
    border-bottom-style: solid;
  }

  /* Blockquote */
  .ide-prose blockquote {
    margin: 32px 0;
    padding: 16px 20px;
    border-left: 3px solid var(--ide-green);
    background: var(--ide-bg-alt);
    border-radius: 0 6px 6px 0;
    position: relative;
  }
  .ide-prose blockquote::before {
    content: ">";
    position: absolute;
    left: 10px;
    top: 16px;
    font-family: var(--ide-font-mono);
    font-size: 14px;
    color: var(--ide-green);
    font-weight: 700;
    opacity: 0.5;
  }
  .ide-prose blockquote p {
    margin-bottom: 6px;
    color: var(--ide-text);
    font-size: 14px;
    line-height: 1.7;
    font-style: italic;
    padding-left: 12px;
  }
  .ide-prose blockquote cite {
    font-size: 12px;
    color: var(--ide-text-muted);
    font-style: normal;
    font-family: var(--ide-font-mono);
    padding-left: 12px;
  }

  /* Lists */
  .ide-prose ul,
  .ide-prose ol {
    margin: 16px 0;
    padding-left: 24px;
  }
  .ide-prose li {
    margin-bottom: 8px;
    font-size: 14px;
    color: var(--ide-text-secondary);
  }
  .ide-prose li strong {
    color: var(--ide-peach);
    font-weight: 600;
  }
  .ide-prose li::marker {
    color: var(--ide-text-subtle);
  }

  /* Table */
  .ide-prose table {
    width: 100%;
    margin: 28px 0;
    border-collapse: collapse;
    font-size: 13px;
    border: 1px solid var(--ide-border);
    border-radius: 6px;
    overflow: hidden;
  }
  .ide-prose th {
    font-family: var(--ide-font-mono);
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--ide-yellow);
    text-align: left;
    padding: 10px 14px;
    background: var(--ide-bg-alt);
    border-bottom: 1px solid var(--ide-border);
  }
  .ide-prose td {
    padding: 8px 14px;
    border-bottom: 1px solid var(--ide-border-subtle);
    color: var(--ide-text-secondary);
    font-family: var(--ide-font-mono);
    font-size: 13px;
  }
  .ide-prose tr:last-child td {
    border-bottom: none;
  }
  .ide-prose tr:hover td {
    background: var(--ide-bg-highlight);
  }

  /* Code - syntax highlighting */
  .ide-prose code {
    font-family: var(--ide-font-mono);
    font-size: 13px;
    background: var(--ide-bg-surface);
    padding: 2px 6px;
    border-radius: 4px;
    color: var(--ide-pink);
  }
  .ide-prose pre {
    margin: 28px 0;
    padding: 20px;
    background: var(--ide-bg-alt);
    border-radius: 6px;
    border: 1px solid var(--ide-border);
    overflow-x: auto;
    font-size: 13px;
    line-height: 1.7;
    position: relative;
  }
  .ide-prose pre::before {
    content: "typescript";
    position: absolute;
    top: 0;
    right: 0;
    font-family: var(--ide-font-mono);
    font-size: 10px;
    padding: 3px 10px;
    background: var(--ide-bg-surface);
    color: var(--ide-text-muted);
    border-radius: 0 6px 0 6px;
    border-bottom: 1px solid var(--ide-border);
    border-left: 1px solid var(--ide-border);
  }
  .ide-prose pre code {
    background: none;
    padding: 0;
    font-size: inherit;
    color: var(--ide-text);
  }

  /* Syntax highlighting classes */
  .ide-syn-keyword {
    color: var(--ide-mauve);
    font-weight: 500;
  }
  .ide-syn-fn {
    color: var(--ide-blue);
  }
  .ide-syn-type {
    color: var(--ide-yellow);
  }
  .ide-syn-param {
    color: var(--ide-peach);
    font-style: italic;
  }
  .ide-syn-str {
    color: var(--ide-green);
  }
  .ide-syn-num {
    color: var(--ide-peach);
  }
  .ide-syn-comment {
    color: var(--ide-text-subtle);
    font-style: italic;
  }

  /* Figure/Diagram placeholder */
  .ide-placeholder-diagram {
    margin: 28px 0;
    padding: 32px;
    background: var(--ide-bg-alt);
    border: 1px dashed var(--ide-border);
    border-radius: 6px;
    text-align: center;
    font-family: var(--ide-font-mono);
    color: var(--ide-text-muted);
  }
  .ide-placeholder-diagram > span {
    font-weight: 600;
    font-size: 13px;
    display: block;
    margin-bottom: 14px;
    color: var(--ide-text-secondary);
  }
  .ide-diagram-nodes {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .ide-diagram-node {
    padding: 6px 14px;
    background: var(--ide-bg-surface);
    border: 1px solid var(--ide-border);
    border-radius: 4px;
    font-size: 11px;
    font-weight: 500;
    color: var(--ide-text-secondary);
  }
  .ide-diagram-leader {
    background: var(--ide-accent);
    color: var(--ide-bg);
    border-color: var(--ide-accent);
    font-weight: 600;
  }
  .ide-diagram-arrows {
    color: var(--ide-green);
    font-size: 16px;
    display: flex;
    gap: 4px;
  }
  .ide-prose figcaption {
    text-align: center;
    font-size: 12px;
    color: var(--ide-text-muted);
    margin-top: 10px;
    font-family: var(--ide-font-mono);
    font-style: italic;
  }

  /* --- Article Navigation --- */
  .ide-article-nav {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    padding: 24px 0 48px;
  }
  .ide-nav-prev,
  .ide-nav-next {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 16px;
    border: 1px solid var(--ide-border);
    border-radius: 6px;
    text-decoration: none;
    transition: all var(--ide-transition);
    background: var(--ide-bg-alt);
  }
  .ide-nav-prev:hover,
  .ide-nav-next:hover {
    border-color: var(--ide-accent);
    background: var(--ide-bg-highlight);
  }
  .ide-nav-next {
    text-align: right;
  }
  .ide-nav-label {
    font-family: var(--ide-font-mono);
    font-size: 11px;
    font-weight: 500;
    color: var(--ide-green);
  }
  .ide-nav-title {
    font-family: var(--ide-font-mono);
    font-size: 13px;
    font-weight: 500;
    color: var(--ide-text-secondary);
    line-height: 1.4;
  }

  /* ================================================================
     STATUS BAR (VS Code-style footer)
     ================================================================ */
  .ide-statusbar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
    height: var(--ide-statusbar-height);
    background: var(--ide-accent);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 12px;
    font-family: var(--ide-font-mono);
    font-size: 11px;
    color: var(--ide-bg);
  }
  .ide-statusbar-left,
  .ide-statusbar-right {
    display: flex;
    align-items: center;
    gap: 2px;
  }
  .ide-statusbar-item {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 0 8px;
    height: var(--ide-statusbar-height);
    white-space: nowrap;
    transition: background var(--ide-transition-fast);
  }
  .ide-statusbar-item:hover {
    background: rgba(0, 0, 0, 0.12);
  }
  .ide-statusbar-item svg {
    flex-shrink: 0;
  }

  /* Reading progress in status bar */
  .ide-statusbar-progress {
    gap: 6px;
  }
  .ide-progress-label {
    font-weight: 500;
  }
  .ide-progress-bar {
    width: 60px;
    height: 4px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 2px;
    overflow: hidden;
  }
  .ide-progress-fill {
    display: block;
    width: 0%;
    height: 100%;
    background: var(--ide-bg);
    border-radius: 2px;
    transition: width 100ms ease;
  }
  .ide-progress-pct {
    min-width: 28px;
    text-align: right;
  }

  @media (max-width: 640px) {
    .ide-statusbar-right {
      gap: 0;
    }
    .ide-statusbar-item:not(.ide-statusbar-progress):not(.ide-statusbar-branch) {
      display: none;
    }
    .ide-statusbar-branch {
      display: flex;
    }
    .ide-statusbar-progress {
      display: flex;
    }
    .ide-statusbar-words {
      display: flex !important;
    }
  }

  /* ================================================================
     RESPONSIVE
     ================================================================ */
  @media (max-width: 640px) {
    .ide-sidebar {
      width: min(85vw, 320px);
    }
    .ide-main {
      padding: 0 16px calc(var(--ide-statusbar-height) + 40px);
    }
    .ide-article-nav {
      grid-template-columns: 1fr;
    }
    .ide-tabs {
      display: none;
    }
  }
  @media (max-width: 768px) {
    .ide-tabs .ide-tab:not(.ide-tab--active) {
      display: none;
    }
  }

  /* ================================================================
     FOCUS STYLES
     ================================================================ */
  :focus-visible {
    outline: 2px solid var(--ide-accent);
    outline-offset: 2px;
  }
  .ide-sidebar :focus-visible,
  .ide-header :focus-visible {
    outline-offset: -2px;
  }

  /* ================================================================
     SCROLLBAR (global dark theme)
     ================================================================ */
  body::-webkit-scrollbar {
    width: 10px;
  }
  body::-webkit-scrollbar-track {
    background: var(--ide-bg);
  }
  body::-webkit-scrollbar-thumb {
    background: var(--ide-gutter);
    border-radius: 5px;
    border: 2px solid var(--ide-bg);
  }
  body::-webkit-scrollbar-thumb:hover {
    background: var(--ide-text-subtle);
  }
  body {
    scrollbar-width: thin;
    scrollbar-color: var(--ide-gutter) var(--ide-bg);
  }
</style>

<script>
  function initIdeLayout() {
    const toggleLeft = document.querySelector(".ide-toggle-left") as HTMLButtonElement | null
    const toggleRight = document.querySelector(".ide-toggle-right") as HTMLButtonElement | null
    const sidebarLeft = document.getElementById("sidebar-left")
    const sidebarRight = document.getElementById("sidebar-right")
    const backdrop = document.getElementById("sidebar-backdrop")

    function closeSidebars() {
      sidebarLeft?.classList.remove("is-open")
      sidebarRight?.classList.remove("is-open")
      backdrop?.classList.remove("is-visible")
      toggleLeft?.setAttribute("aria-expanded", "false")
      toggleRight?.setAttribute("aria-expanded", "false")
      document.body.style.overflow = ""
    }

    function toggleSidebar(sidebar: HTMLElement | null, toggle: HTMLButtonElement | null) {
      if (!sidebar || !toggle) return
      const isOpen = sidebar.classList.contains("is-open")
      closeSidebars()
      if (!isOpen) {
        sidebar.classList.add("is-open")
        backdrop?.classList.add("is-visible")
        toggle.setAttribute("aria-expanded", "true")
        document.body.style.overflow = "hidden"
      }
    }

    toggleLeft?.addEventListener("click", () => toggleSidebar(sidebarLeft, toggleLeft))
    toggleRight?.addEventListener("click", () => toggleSidebar(sidebarRight, toggleRight))
    backdrop?.addEventListener("click", closeSidebars)

    // Close buttons inside sidebars
    document.querySelectorAll(".ide-sidebar-close").forEach((btn) => {
      btn.addEventListener("click", closeSidebars)
    })

    // Escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeSidebars()
    })

    // Remember sidebar state on desktop via localStorage
    const savedLeft = localStorage.getItem("ide-sidebar-left")
    const savedRight = localStorage.getItem("ide-sidebar-right")
    const isDesktop = window.matchMedia("(min-width: 1024px)").matches

    if (isDesktop && savedLeft === "open") {
      sidebarLeft?.classList.add("is-open")
      toggleLeft?.setAttribute("aria-expanded", "true")
    }
    if (isDesktop && savedRight === "open") {
      sidebarRight?.classList.add("is-open")
      toggleRight?.setAttribute("aria-expanded", "true")
    }

    // Save state on toggle (desktop only)
    toggleLeft?.addEventListener("click", () => {
      if (window.matchMedia("(min-width: 1024px)").matches) {
        const isOpen = sidebarLeft?.classList.contains("is-open")
        localStorage.setItem("ide-sidebar-left", isOpen ? "open" : "closed")
      }
    })
    toggleRight?.addEventListener("click", () => {
      if (window.matchMedia("(min-width: 1024px)").matches) {
        const isOpen = sidebarRight?.classList.contains("is-open")
        localStorage.setItem("ide-sidebar-right", isOpen ? "open" : "closed")
      }
    })

    // --- Line numbers generation ---
    const lineNumbersEl = document.querySelector(".ide-line-numbers") as HTMLElement | null
    const contentArea = document.querySelector(".ide-content-area") as HTMLElement | null
    if (lineNumbersEl && contentArea) {
      function updateLineNumbers() {
        if (!lineNumbersEl || !contentArea) return
        const contentHeight = contentArea.offsetHeight
        const lineHeight = parseFloat(getComputedStyle(contentArea).lineHeight) || 24
        const lineCount = Math.ceil(contentHeight / lineHeight)
        const fragment = document.createDocumentFragment()
        for (let i = 1; i <= lineCount; i++) {
          const span = document.createElement("div")
          span.textContent = String(i)
          span.style.height = lineHeight + "px"
          span.style.lineHeight = lineHeight + "px"
          fragment.appendChild(span)
        }
        lineNumbersEl.innerHTML = ""
        lineNumbersEl.appendChild(fragment)
      }
      // Generate after layout settles
      requestAnimationFrame(() => {
        setTimeout(updateLineNumbers, 100)
      })
      window.addEventListener("resize", updateLineNumbers)
    }

    // --- Reading progress for status bar ---
    const progressFill = document.getElementById("reading-progress") as HTMLElement | null
    const progressPct = document.getElementById("reading-pct") as HTMLElement | null
    const article = document.querySelector(".ide-article") as HTMLElement | null

    function updateReadingProgress() {
      if (!article || !progressFill || !progressPct) return
      const rect = article.getBoundingClientRect()
      const totalHeight = rect.height
      const scrolled = Math.max(0, -rect.top)
      const viewportHeight = window.innerHeight
      const progress = Math.min(100, Math.max(0, (scrolled / (totalHeight - viewportHeight)) * 100))
      const rounded = Math.round(progress)
      progressFill.style.width = rounded + "%"
      progressPct.textContent = rounded + "%"
    }

    window.addEventListener("scroll", updateReadingProgress, { passive: true })
    updateReadingProgress()
  }

  document.addEventListener("DOMContentLoaded", initIdeLayout)
</script>
