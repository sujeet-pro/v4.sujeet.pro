---
/**
 * Style 2: "The Index" — Developer directory layout
 *
 * Compact profile, every category as a row with horizontal rule,
 * topics comma-separated, featured articles as minimal one-liners.
 * Vibe: hacker's homepage, man page aesthetic.
 */
import { getEntry } from "astro:content"
import Layout from "@/layout/layout.astro"
import Link from "@/components/ui/link.astro"
import { getCategoryHierarchy, getFeaturedArticlesCards } from "@/utils/content"
import { getSocialLinks } from "@/utils/site.utils"

const homeEntry = await getEntry("home", "home")
if (!homeEntry) throw new Error("Home page content not found.")
const { profile } = homeEntry.data

const social = await getSocialLinks()
const categories = await getCategoryHierarchy()
const featuredArticles = await getFeaturedArticlesCards()
const totalArticles = categories.reduce((sum, cat) => sum + cat.articleCount, 0)
const totalTopics = categories.reduce((sum, cat) => sum + cat.topics.length, 0)
---

<Layout title="Sujeet Jaiswal — Principal Software Engineer" description={profile.bio} crumbs={null} pageType="default">
  <div class="ix-page">

    <!-- Header block -->
    <header class="ix-header">
      <div class="ix-identity">
        <h1 class="ix-name">{profile.name}</h1>
        <p class="ix-title">{profile.title} · Frontend Architecture</p>
      </div>
      <p class="ix-tagline">
        Building systems that serve millions.<br />
        Writing about what I learn along the way.
      </p>
      <nav class="ix-nav">
        <Link href={social.linkedin.url} class="ix-nav-item">linkedin</Link>
        <Link href="/cv" class="ix-nav-item" isVanity={true}>cv</Link>
        <Link href="/random" class="ix-nav-item">random</Link>
        <Link href="/articles" class="ix-nav-item ix-nav-item--primary">all articles</Link>
      </nav>
    </header>

    <div class="ix-divider ix-divider--double"></div>

    <!-- Knowledge Hub -->
    <section class="ix-section">
      <div class="ix-section-head">
        <h2 class="ix-section-title">Knowledge Hub</h2>
        <span class="ix-section-count">{totalArticles}+ articles · {categories.length} categories · {totalTopics} topics</span>
      </div>
      <p class="ix-section-desc">
        Deep-dive articles for engineers who want to understand how things actually work.
      </p>

      <div class="ix-directory">
        {categories.map((category, index) => (
          <div class="ix-row" style={`animation-delay: ${index * 60}ms`}>
            <div class="ix-row-line"></div>
            <div class="ix-row-content">
              <div class="ix-row-header">
                <h3 class="ix-row-name">
                  <Link href={category.href} class="ix-row-link">{category.name}</Link>
                </h3>
                <span class="ix-row-count">{category.articleCount}</span>
              </div>
              <p class="ix-row-topics">
                {category.topics.map((topic, i) => (
                  <>
                    <Link href={topic.href} class="ix-topic-link">{topic.name}</Link>
                    {i < category.topics.length - 1 && ", "}
                  </>
                ))}
              </p>
            </div>
          </div>
        ))}
      </div>
    </section>

    <div class="ix-divider ix-divider--double"></div>

    <!-- Featured Reads -->
    {featuredArticles.length > 0 && (
      <section class="ix-section">
        <div class="ix-section-head">
          <h2 class="ix-section-title">Featured Reads</h2>
        </div>

        <ul class="ix-reads">
          {featuredArticles.map((article, index) => (
            <li class="ix-read" style={`animation-delay: ${index * 50}ms`}>
              <span class="ix-read-arrow">&rarr;</span>
              <div class="ix-read-content">
                <Link href={article.href} class="ix-read-title">{article.title}</Link>
                <span class="ix-read-meta">
                  {article.topic.name}
                  {article.minutesRead && <> · {article.minutesRead}</>}
                </span>
              </div>
            </li>
          ))}
        </ul>
      </section>
    )}

  </div>
</Layout>

<style is:global>
  @reference "tailwindcss";

  .ix-page {
    @apply mx-auto;
    max-width: var(--content-max-width);
    padding-top: 3rem;
    padding-bottom: 4rem;
  }

  /* ── Header ── */
  .ix-header {
    animation: fadeInUp var(--transition-slow) forwards;
  }

  .ix-identity {
    @apply mb-4;
  }

  .ix-name {
    @apply font-sans font-normal;
    font-size: clamp(28px, 5vw, 38px);
    line-height: 1.15;
    letter-spacing: -0.03em;
    color: var(--color-text);
  }

  .ix-title {
    @apply mt-1;
    font-family: var(--font-mono);
    font-size: 13px;
    letter-spacing: 0.02em;
    color: var(--color-text-muted);
  }

  .ix-tagline {
    @apply mb-6 text-base leading-relaxed;
    color: var(--color-text-secondary);
    max-width: 48ch;
  }

  .ix-nav {
    @apply flex flex-wrap items-center gap-1;
  }

  .ix-nav-item {
    font-family: var(--font-mono);
    font-size: 12px;
    letter-spacing: 0.03em;
    color: var(--color-text-muted);
    text-decoration: none;
    padding: 6px 12px;
    border: 1px solid var(--color-border);
    border-radius: 3px;
    transition: all var(--transition-fast);
  }

  .ix-nav-item:hover {
    color: var(--color-text);
    border-color: var(--color-text);
  }

  .ix-nav-item--primary {
    color: #fff;
    background: var(--color-text);
    border-color: var(--color-text);
  }

  .ix-nav-item--primary:hover {
    color: #fff;
    background: var(--color-accent-hover);
  }

  /* ── Dividers ── */
  .ix-divider {
    @apply my-10;
    height: 1px;
    background: var(--color-border);
  }

  .ix-divider--double {
    height: 3px;
    border-top: 1px solid var(--color-text);
    border-bottom: 1px solid var(--color-text);
    background: transparent;
  }

  /* ── Sections ── */
  .ix-section {
    animation: fadeInUp var(--transition-slow) 150ms forwards;
    opacity: 0;
  }

  .ix-section-head {
    @apply mb-2 flex flex-wrap items-baseline justify-between gap-4;
  }

  .ix-section-title {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--color-text-muted);
    font-weight: 400;
  }

  .ix-section-count {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.06em;
    color: var(--color-text-muted);
  }

  .ix-section-desc {
    @apply mb-8 text-base;
    color: var(--color-text-secondary);
    max-width: 55ch;
  }

  /* ── Directory Rows ── */
  .ix-directory {
    @apply flex flex-col;
  }

  .ix-row {
    animation: fadeInUp var(--transition-slow) forwards;
    opacity: 0;
  }

  .ix-row-line {
    height: 1px;
    background: var(--color-border);
  }

  .ix-row-content {
    @apply py-5 pl-0;
    transition: padding-left var(--transition-fast);
  }

  .ix-row:hover .ix-row-content {
    padding-left: 8px;
  }

  .ix-row-header {
    @apply mb-2 flex items-baseline justify-between gap-4;
  }

  .ix-row-name {
    @apply font-sans font-medium;
    font-size: 17px;
    line-height: 1.3;
  }

  .ix-row-link {
    color: var(--color-text);
    text-decoration: none;
  }

  .ix-row-link:hover {
    color: var(--color-text-secondary);
  }

  .ix-row-count {
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--color-text-muted);
    white-space: nowrap;
  }

  .ix-row-topics {
    @apply text-sm leading-relaxed;
    color: var(--color-text-muted);
  }

  .ix-topic-link {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .ix-topic-link:hover {
    color: var(--color-text);
  }

  /* Last row bottom border */
  .ix-row:last-child .ix-row-content {
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 1.25rem;
  }

  /* ── Featured Reads ── */
  .ix-reads {
    @apply mt-4 list-none p-0;
  }

  .ix-read {
    @apply flex items-start gap-3 py-3;
    animation: fadeInUp var(--transition-slow) forwards;
    opacity: 0;
  }

  .ix-read-arrow {
    @apply mt-0.5 shrink-0;
    font-family: var(--font-mono);
    font-size: 14px;
    color: var(--color-text-muted);
    transition: transform var(--transition-fast);
  }

  .ix-read:hover .ix-read-arrow {
    transform: translateX(3px);
  }

  .ix-read-content {
    @apply flex flex-col gap-0.5;
  }

  .ix-read-title {
    @apply font-sans text-base font-normal;
    color: var(--color-text);
    text-decoration: none;
    line-height: 1.4;
    transition: color var(--transition-fast);
  }

  .ix-read-title:hover {
    color: var(--color-text-muted);
  }

  .ix-read-meta {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.04em;
    color: var(--color-text-muted);
  }
</style>
