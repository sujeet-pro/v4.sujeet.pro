---
/**
 * Style 5: "The Broadsheet" — Two-column content-dense layout
 *
 * Small profile photo, compact bio. Two-column split below:
 * Left has categories + popular topics. Right has featured articles.
 * Maximum information density. Stacks on mobile.
 * Vibe: newspaper front page.
 */
import { getEntry } from "astro:content"
import Layout from "@/layout/layout.astro"
import Link from "@/components/ui/link.astro"
import { getCategoryHierarchy, getFeaturedArticlesCards, getFeaturedTopics } from "@/utils/content"
import { getSocialLinks } from "@/utils/site.utils"
import sujeetImage from "@/assets/sujeet.jpg"
import { formatCount } from "@/utils/format.utils"

const homeEntry = await getEntry("home", "home")
if (!homeEntry) throw new Error("Home page content not found.")
const { profile } = homeEntry.data

const social = await getSocialLinks()
const categories = await getCategoryHierarchy()
const featuredArticles = await getFeaturedArticlesCards()
const featuredTopics = await getFeaturedTopics()
const totalArticles = categories.reduce((sum, cat) => sum + cat.articleCount, 0)
const totalTopics = categories.reduce((sum, cat) => sum + cat.topics.length, 0)
---

<Layout title="Sujeet Jaiswal — Principal Software Engineer" description={profile.bio} crumbs={null} pageType="default">
  <div class="bs-page">

    <!-- Compact Profile -->
    <header class="bs-header">
      <div class="bs-profile">
        <img src={sujeetImage.src} alt={profile.imageAlt} class="bs-avatar" />
        <div class="bs-profile-content">
          <h1 class="bs-name">{profile.name}</h1>
          <p class="bs-role">{profile.title}</p>
          <p class="bs-bio">
            Frontend architecture, design systems, and end-to-end system design.
            Emphasis on scale, reliability, and performance.
          </p>
          <nav class="bs-links">
            <Link href={social.linkedin.url} class="bs-link">LinkedIn</Link>
            <span class="bs-link-sep">/</span>
            <Link href="/cv" class="bs-link" isVanity={true}>CV</Link>
            <span class="bs-link-sep">/</span>
            <Link href="/articles" class="bs-link">All Articles</Link>
          </nav>
        </div>
      </div>
    </header>

    <!-- Knowledge Hub Intro -->
    <div class="bs-hub-intro">
      <div class="bs-hub-rule"></div>
      <div class="bs-hub-header">
        <h2 class="bs-hub-title">Knowledge Hub</h2>
        <span class="bs-hub-stats">{totalArticles}+ articles · {totalTopics} topics · {categories.length} categories</span>
      </div>
      <p class="bs-hub-desc">
        In-depth technical articles organized by domain. Each category is a structured
        learning path — from fundamentals to real-world case studies.
      </p>
    </div>

    <!-- Two-Column Layout -->
    <div class="bs-columns">

      <!-- Left Column: Categories + Topics -->
      <div class="bs-col-left">
        <h3 class="bs-col-title">Categories</h3>
        <ul class="bs-cat-list">
          {categories.map((category) => (
            <li class="bs-cat-item">
              <Link href={category.href} class="bs-cat-link">{category.name}</Link>
              <span class="bs-cat-count">{category.articleCount}</span>
            </li>
          ))}
        </ul>

        <div class="bs-col-divider"></div>

        <h3 class="bs-col-title">Popular Topics</h3>
        <ul class="bs-topic-list">
          {categories.flatMap(cat => cat.topics).sort((a, b) => b.articles.length - a.articles.length).slice(0, 8).map((topic) => (
            <li class="bs-topic-item">
              <Link href={topic.href} class="bs-topic-link">{topic.name}</Link>
              <span class="bs-topic-count">{formatCount(topic.articles.length, "article")}</span>
            </li>
          ))}
        </ul>
      </div>

      <!-- Vertical Divider (desktop only) -->
      <div class="bs-col-divider-v"></div>

      <!-- Right Column: Featured Topic + Featured Articles -->
      <div class="bs-col-right">
        {featuredTopics.length > 0 && (
          <div class="bs-featured-topic">
            <h3 class="bs-col-title">Featured Topic</h3>
            <div class="bs-ft-card">
              <h4 class="bs-ft-name">
                <Link href={featuredTopics[0].href} class="bs-ft-link">{featuredTopics[0].name}</Link>
              </h4>
              <span class="bs-ft-meta">
                {featuredTopics[0].category.name} · {formatCount(featuredTopics[0].articleCount, "article")}
              </span>
              <ul class="bs-ft-articles">
                {featuredTopics[0].articles.slice(0, 8).map((article) => (
                  <li class="bs-ft-article">
                    <Link href={article.href} class="bs-ft-article-link">{article.title}</Link>
                  </li>
                ))}
                {featuredTopics[0].articles.length > 8 && (
                  <li class="bs-ft-more">
                    <Link href={featuredTopics[0].href} class="bs-ft-more-link">
                      ...and {featuredTopics[0].articles.length - 8} more
                    </Link>
                  </li>
                )}
              </ul>
            </div>
          </div>
        )}

        <div class="bs-col-divider"></div>

        <h3 class="bs-col-title">Featured Articles</h3>
        <ul class="bs-fa-list">
          {featuredArticles.map((article) => (
            <li class="bs-fa-item">
              <Link href={article.href} class="bs-fa-link">{article.title}</Link>
              <span class="bs-fa-meta">
                {article.category.name}
                {article.minutesRead && <> · {article.minutesRead}</>}
              </span>
            </li>
          ))}
        </ul>
      </div>

    </div>

  </div>
</Layout>

<style is:global>
  @reference "tailwindcss";

  .bs-page {
    @apply mx-auto;
    max-width: var(--content-max-width);
    padding-top: 3rem;
    padding-bottom: 4rem;
  }

  /* ── Profile Header ── */
  .bs-header {
    @apply mb-10;
    animation: fadeInUp var(--transition-slow) forwards;
  }

  .bs-profile {
    @apply flex items-start gap-5;
  }

  @media (max-width: 480px) {
    .bs-profile {
      @apply flex-col items-center text-center;
    }
  }

  .bs-avatar {
    @apply shrink-0 rounded-full object-cover;
    width: 72px;
    height: 72px;
    border: 2px solid var(--color-border);
  }

  .bs-profile-content {
    @apply flex-1;
  }

  .bs-name {
    @apply font-sans font-normal;
    font-size: clamp(24px, 4vw, 30px);
    line-height: 1.15;
    letter-spacing: -0.025em;
    color: var(--color-text);
  }

  .bs-role {
    @apply mt-1;
    font-size: 14px;
    color: var(--color-text-muted);
  }

  .bs-bio {
    @apply mt-3 text-sm leading-relaxed;
    color: var(--color-text-secondary);
  }

  .bs-links {
    @apply mt-3 flex flex-wrap items-center gap-1.5;
  }

  @media (max-width: 480px) {
    .bs-links {
      @apply justify-center;
    }
  }

  .bs-link {
    font-family: var(--font-mono);
    font-size: 12px;
    letter-spacing: 0.02em;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .bs-link:hover {
    color: var(--color-text);
  }

  .bs-link-sep {
    color: var(--color-border);
    font-size: 12px;
  }

  /* ── Hub Intro ── */
  .bs-hub-intro {
    @apply mb-10;
    animation: fadeInUp var(--transition-slow) 100ms forwards;
    opacity: 0;
  }

  .bs-hub-rule {
    @apply mb-6;
    height: 2px;
    background: var(--color-text);
  }

  .bs-hub-header {
    @apply mb-3 flex flex-wrap items-baseline justify-between gap-4;
  }

  .bs-hub-title {
    @apply font-sans font-normal;
    font-size: clamp(20px, 3vw, 26px);
    letter-spacing: -0.02em;
    color: var(--color-text);
  }

  .bs-hub-stats {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.06em;
    color: var(--color-text-muted);
  }

  .bs-hub-desc {
    @apply text-sm leading-relaxed;
    color: var(--color-text-secondary);
    max-width: 60ch;
  }

  /* ── Two Column Layout ── */
  .bs-columns {
    @apply flex flex-col gap-8;
    animation: fadeInUp var(--transition-slow) 200ms forwards;
    opacity: 0;
  }

  @media (min-width: 640px) {
    .bs-columns {
      @apply flex-row gap-0;
    }

    .bs-col-left {
      flex: 0 0 38%;
      padding-right: 1.5rem;
    }

    .bs-col-right {
      flex: 1;
      padding-left: 1.5rem;
    }

    .bs-col-divider-v {
      flex: 0 0 1px;
      background: var(--color-border);
    }
  }

  .bs-col-divider-v {
    display: none;
  }

  @media (min-width: 640px) {
    .bs-col-divider-v {
      display: block;
    }
  }

  /* ── Column Titles ── */
  .bs-col-title {
    @apply mb-4;
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--color-text-muted);
    font-weight: 400;
  }

  .bs-col-divider {
    @apply my-6;
    height: 1px;
    background: var(--color-border);
  }

  /* ── Category List (Left) ── */
  .bs-cat-list {
    @apply list-none p-0;
  }

  .bs-cat-item {
    @apply flex items-baseline justify-between gap-2 py-1.5;
  }

  .bs-cat-link {
    @apply font-sans text-sm font-medium;
    color: var(--color-text);
    text-decoration: none;
    transition: color var(--transition-fast);
    line-height: 1.4;
  }

  .bs-cat-link:hover {
    color: var(--color-text-muted);
  }

  .bs-cat-count {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--color-text-muted);
  }

  /* ── Popular Topics (Left) ── */
  .bs-topic-list {
    @apply list-none p-0;
  }

  .bs-topic-item {
    @apply flex items-baseline justify-between gap-2 py-1.5;
  }

  .bs-topic-link {
    @apply text-sm;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color var(--transition-fast);
    line-height: 1.4;
  }

  .bs-topic-link:hover {
    color: var(--color-text);
  }

  .bs-topic-count {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--color-text-muted);
    white-space: nowrap;
  }

  /* ── Featured Topic (Right) ── */
  .bs-featured-topic {
    @apply mb-0;
  }

  .bs-ft-card {
    @apply p-4;
    border: 1px solid var(--color-border);
    border-radius: 4px;
  }

  .bs-ft-name {
    @apply mb-1 font-sans text-base font-medium;
    line-height: 1.3;
  }

  .bs-ft-link {
    color: var(--color-text);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .bs-ft-link:hover {
    color: var(--color-text-muted);
  }

  .bs-ft-meta {
    @apply mb-3 block;
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.04em;
    color: var(--color-text-muted);
  }

  .bs-ft-articles {
    @apply list-none p-0;
  }

  .bs-ft-article {
    @apply py-1;
  }

  .bs-ft-article-link {
    @apply text-sm;
    color: var(--color-text-secondary);
    text-decoration: none;
    line-height: 1.5;
    transition: color var(--transition-fast);
  }

  .bs-ft-article-link::before {
    content: "· ";
    color: var(--color-text-muted);
  }

  .bs-ft-article-link:hover {
    color: var(--color-text);
  }

  .bs-ft-more {
    @apply pt-1;
  }

  .bs-ft-more-link {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .bs-ft-more-link:hover {
    color: var(--color-text);
  }

  /* ── Featured Articles (Right) ── */
  .bs-fa-list {
    @apply list-none p-0;
  }

  .bs-fa-item {
    @apply flex flex-col gap-0.5 py-3;
    border-bottom: 1px solid var(--color-border);
  }

  .bs-fa-item:first-child {
    border-top: 1px solid var(--color-border);
  }

  .bs-fa-link {
    @apply font-sans text-base font-normal;
    color: var(--color-text);
    text-decoration: none;
    line-height: 1.4;
    transition: color var(--transition-fast);
  }

  .bs-fa-link:hover {
    color: var(--color-text-muted);
  }

  .bs-fa-meta {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.04em;
    color: var(--color-text-muted);
  }
</style>
