---
/**
 * Style 4: "The Dashboard" — Stats-forward knowledge hub
 *
 * Large stats banner, category cards in 2-col grid,
 * featured articles with excerpts. No photo.
 * Vibe: dashboard/catalog, numbers tell the story.
 */
import { getEntry } from "astro:content"
import Layout from "@/layout/layout.astro"
import Link from "@/components/ui/link.astro"
import { getCategoryHierarchy, getFeaturedArticlesCards } from "@/utils/content"
import { getSocialLinks } from "@/utils/site.utils"
import { formatCount } from "@/utils/format.utils"

const homeEntry = await getEntry("home", "home")
if (!homeEntry) throw new Error("Home page content not found.")
const { profile } = homeEntry.data

const social = await getSocialLinks()
const categories = await getCategoryHierarchy()
const featuredArticles = await getFeaturedArticlesCards()
const totalArticles = categories.reduce((sum, cat) => sum + cat.articleCount, 0)
const totalTopics = categories.reduce((sum, cat) => sum + cat.topics.length, 0)

// Short category descriptions for cards
const categoryTaglines: Record<string, string> = {
  "system-design": "The backbone of large-scale systems — from fundamentals to real-world case studies",
  "browser-runtime-internals": "From DOM construction to pixel composition — how browsers really work",
  "platform-engineering": "Infrastructure, observability, and delivery systems that support product teams",
  "frontend-engineering": "Architecture patterns, performance, and design systems at scale",
  "web-foundations": "Protocols, security models, and browser APIs that underpin the web",
  "programming-patterns": "Data structures, algorithms, and JavaScript patterns for clean code",
  "developer-experience": "Tooling and workflows for productive engineering",
}
---

<Layout title="Sujeet Jaiswal — Principal Software Engineer" description={profile.bio} crumbs={null} pageType="default">
  <div class="db-page">

    <!-- Header -->
    <header class="db-header">
      <h1 class="db-name">{profile.name}</h1>
      <p class="db-subtitle">{profile.title}</p>
      <p class="db-desc">
        Deep-dive technical articles on system design, browser internals,
        frontend architecture, and everything in between.
      </p>
      <nav class="db-nav">
        <Link href={social.linkedin.url} class="db-nav-item">LinkedIn</Link>
        <Link href="/cv" class="db-nav-item" isVanity={true}>CV</Link>
        <Link href="/random" class="db-nav-item">I'm Feeling Lucky</Link>
      </nav>
    </header>

    <!-- Stats Banner -->
    <div class="db-stats">
      <div class="db-stat">
        <span class="db-stat-number">{totalArticles}+</span>
        <span class="db-stat-label">articles</span>
      </div>
      <div class="db-stat-divider"></div>
      <div class="db-stat">
        <span class="db-stat-number">{categories.length}</span>
        <span class="db-stat-label">categories</span>
      </div>
      <div class="db-stat-divider"></div>
      <div class="db-stat">
        <span class="db-stat-number">{totalTopics}+</span>
        <span class="db-stat-label">topics</span>
      </div>
    </div>

    <!-- Knowledge Hub -->
    <section class="db-section">
      <div class="db-section-head">
        <h2 class="db-section-title">Knowledge Hub</h2>
        <Link href="/articles" class="db-section-link">Browse all &rarr;</Link>
      </div>

      <div class="db-grid">
        {categories.map((category, index) => (
          <a href={category.href} class="db-card" style={`animation-delay: ${index * 70}ms`}>
            <div class="db-card-head">
              <h3 class="db-card-name">{category.name}</h3>
              <span class="db-card-counts">
                {category.topics.length} {category.topics.length === 1 ? "topic" : "topics"} · {category.articleCount} articles
              </span>
            </div>
            <p class="db-card-desc">
              {categoryTaglines[category.id] || category.description}
            </p>
            <span class="db-card-arrow">&rarr;</span>
          </a>
        ))}
      </div>
    </section>

    <!-- Featured Articles -->
    {featuredArticles.length > 0 && (
      <section class="db-section">
        <div class="db-section-head">
          <h2 class="db-section-title">Featured Articles</h2>
          <Link href="/articles" class="db-section-link">All articles &rarr;</Link>
        </div>

        <ul class="db-articles">
          {featuredArticles.map((article, index) => (
            <li class="db-article" style={`animation-delay: ${index * 60}ms`}>
              <h3 class="db-article-title">
                <Link href={article.href} class="db-article-link">{article.title}</Link>
              </h3>
              <span class="db-article-meta">
                {article.category.name} · {article.topic.name}
                {article.minutesRead && <> · {article.minutesRead}</>}
              </span>
              {article.description && (
                <p class="db-article-excerpt">{article.description}</p>
              )}
            </li>
          ))}
        </ul>
      </section>
    )}

  </div>
</Layout>

<style is:global>
  @reference "tailwindcss";

  .db-page {
    @apply mx-auto;
    max-width: var(--content-max-width);
    padding-top: 3rem;
    padding-bottom: 4rem;
  }

  /* ── Header ── */
  .db-header {
    @apply mb-10;
    animation: fadeInUp var(--transition-slow) forwards;
  }

  .db-name {
    @apply font-sans font-normal;
    font-size: clamp(30px, 5vw, 42px);
    line-height: 1.1;
    letter-spacing: -0.03em;
    color: var(--color-text);
  }

  .db-subtitle {
    @apply mt-2;
    font-size: 16px;
    color: var(--color-text-muted);
  }

  .db-desc {
    @apply mt-5 text-base leading-relaxed;
    color: var(--color-text-secondary);
    max-width: 55ch;
  }

  .db-nav {
    @apply mt-6 flex flex-wrap items-center gap-2;
  }

  .db-nav-item {
    font-family: var(--font-mono);
    font-size: 12px;
    letter-spacing: 0.03em;
    color: var(--color-text-muted);
    text-decoration: none;
    padding: 6px 14px;
    border: 1px solid var(--color-border);
    border-radius: 3px;
    transition: all var(--transition-fast);
  }

  .db-nav-item:hover {
    color: var(--color-text);
    border-color: var(--color-text);
  }

  /* ── Stats Banner ── */
  .db-stats {
    @apply mx-auto mb-14 flex items-center justify-center gap-6;
    padding: 2rem 2.5rem;
    border-top: 2px solid var(--color-text);
    border-bottom: 2px solid var(--color-text);
    animation: fadeInUp var(--transition-slow) 100ms forwards;
    opacity: 0;
  }

  @media (max-width: 480px) {
    .db-stats {
      @apply gap-4;
      padding: 1.5rem 1rem;
    }
  }

  .db-stat {
    @apply flex flex-col items-center;
  }

  .db-stat-number {
    font-family: var(--font-mono);
    font-size: clamp(28px, 6vw, 48px);
    font-weight: 300;
    line-height: 1;
    letter-spacing: -0.03em;
    color: var(--color-text);
  }

  .db-stat-label {
    @apply mt-2;
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--color-text-muted);
  }

  .db-stat-divider {
    @apply self-stretch;
    width: 1px;
    background: var(--color-border);
  }

  /* ── Sections ── */
  .db-section {
    @apply mb-14;
    animation: fadeInUp var(--transition-slow) 200ms forwards;
    opacity: 0;
  }

  .db-section-head {
    @apply mb-6 flex flex-wrap items-baseline justify-between gap-4;
  }

  .db-section-title {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--color-text-muted);
    font-weight: 400;
  }

  .db-section-link {
    font-family: var(--font-mono);
    font-size: 12px;
    letter-spacing: 0.04em;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .db-section-link:hover {
    color: var(--color-text);
  }

  /* ── Category Cards Grid ── */
  .db-grid {
    @apply grid gap-4;
    grid-template-columns: 1fr;
  }

  @media (min-width: 640px) {
    .db-grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  .db-card {
    @apply relative block p-5;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    text-decoration: none;
    transition: all var(--transition-fast);
    animation: fadeInUp var(--transition-slow) forwards;
    opacity: 0;
  }

  .db-card:hover {
    border-color: var(--color-text);
  }

  .db-card:hover .db-card-arrow {
    opacity: 1;
    transform: translateX(0);
  }

  .db-card-head {
    @apply mb-3;
  }

  .db-card-name {
    @apply font-sans text-lg font-medium;
    color: var(--color-text);
    line-height: 1.3;
  }

  .db-card-counts {
    @apply mt-1 block;
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.06em;
    color: var(--color-text-muted);
  }

  .db-card-desc {
    @apply text-sm leading-relaxed;
    color: var(--color-text-secondary);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .db-card-arrow {
    @apply absolute right-4 top-5;
    font-family: var(--font-mono);
    font-size: 16px;
    color: var(--color-text);
    opacity: 0;
    transform: translateX(-4px);
    transition: all var(--transition-fast);
  }

  /* ── Featured Articles ── */
  .db-articles {
    @apply list-none p-0;
  }

  .db-article {
    @apply py-5;
    border-bottom: 1px solid var(--color-border);
    animation: fadeInUp var(--transition-slow) forwards;
    opacity: 0;
  }

  .db-article:first-child {
    border-top: 1px solid var(--color-border);
  }

  .db-article-title {
    @apply mb-1 font-sans text-lg font-normal;
    line-height: 1.4;
  }

  .db-article-link {
    color: var(--color-text);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .db-article-link:hover {
    color: var(--color-text-muted);
  }

  .db-article-meta {
    @apply mb-2 block;
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 0.06em;
    color: var(--color-text-muted);
  }

  .db-article-excerpt {
    @apply text-sm leading-relaxed;
    color: var(--color-text-secondary);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
