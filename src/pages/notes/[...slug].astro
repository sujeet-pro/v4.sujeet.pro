---
import { getNotesIncludingDrafts } from "@/utils/content-collection.utils"
import Layout from "@/layout/layout.astro"
import ArticleNavigation from "@/components/article-navigation.astro"
import ArticleTags from "@/components/article-tags.astro"
import TOC from "@/components/toc.astro"
import Frontmatter from "@/components/frontmatter.astro"
import ReadingProgress from "@/components/reading-progress.astro"

// Generate static paths for all notes (including drafts)
export async function getStaticPaths() {
  const notes = await getNotesIncludingDrafts()

  return notes.map((item, index) => {
    const nextItem = index < notes.length - 1 ? notes[index + 1] : null
    const prevItem = index > 0 ? notes[index - 1] : null

    return {
      params: { slug: item.pageSlug },
      props: {
        item,
        nextItem,
        prevItem,
      },
    }
  })
}

const { item, nextItem, prevItem } = Astro.props
const { description, publishedOn, lastUpdatedOn, title, minutesRead, tags, Content, isDraft, category } = item

const crumbs = [
  { name: "Notes", href: "/notes" },
  ...(category ? [{ name: category.name, href: category.href, title: category.title }] : []),
]
---

<Layout {title} {description} {crumbs} pageType="article" noIndex={isDraft} layout="3col">
  <!-- TOC in right sidebar -->
  <TOC slot="sidebar-right" />

  <!-- Content top (above main) -->
  <ReadingProgress slot="content-top" />
  <Frontmatter slot="content-top" {minutesRead} {publishedOn} {lastUpdatedOn} {isDraft} class="my-4" />

  <!-- Main content (default slot) -->
  <article class="article-prose-content">
    <Content />
  </article>

  <!-- Content bottom (below main) -->
  <ArticleTags slot="content-bottom" {tags} />
  <ArticleNavigation slot="content-bottom" {prevItem} {nextItem} />
</Layout>
