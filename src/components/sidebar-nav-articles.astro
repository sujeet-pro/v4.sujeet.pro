---
/**
 * Sidebar Nav - Articles
 * For article pages: category > topic > articles hierarchy, current highlighted
 */
import Link from "@/components/link.astro"
import { getCategoryPage } from "@/utils/content"

interface Props {
  categoryId: string
  topicId: string
  currentArticleId: string
}

const { categoryId, topicId, currentArticleId } = Astro.props
const categoryData = await getCategoryPage(categoryId)
---

{
  categoryData && (
    <nav aria-label="Article navigation">
      <h2 class="sidebar-nav-title">
        <Link href={categoryData.category.href} class="sidebar-nav-item" style="padding: 0; margin-bottom: 4px;">
          {categoryData.category.name}
        </Link>
      </h2>
      {categoryData.topics.map((topic) => (
        <div class="sidebar-nav-section">
          <Link
            href={topic.href}
            class:list={["sidebar-nav-item", "sidebar-nav-category", { "is-active": topicId === topic.id }]}
          >
            {topic.name}
          </Link>
          {topicId === topic.id && (
            <ul class="sidebar-nav-list sidebar-nav-articles-list">
              {topic.articles.map((article) => (
                <li>
                  <Link
                    href={article.href}
                    class:list={[
                      "sidebar-nav-item",
                      "sidebar-nav-article-item",
                      { "is-active": currentArticleId === article.postId },
                    ]}
                  >
                    {article.title}
                  </Link>
                </li>
              ))}
            </ul>
          )}
        </div>
      ))}
    </nav>
  )
}

<style is:global>
  @reference "tailwindcss";

  .sidebar-nav-articles-list {
    @apply ml-2 border-l pl-2;
    border-color: var(--color-border);
  }

  .sidebar-nav-article-item {
    font-size: 13px;
    line-height: 1.4;
  }
</style>
