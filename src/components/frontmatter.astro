---
import { Icon } from "astro-icon/components"
import { CONTENT_TYPE_LABELS } from "@constants/site"
import type { ContentItem, CategoryRef } from "@/utils/content.type"
import Link from "./link.astro"

interface Props {
  minutesRead: string
  publishedOn: Date
  lastUpdatedOn?: Date | undefined
  isDraft: boolean
  class?: string
  /** Show content type badge (Writing, Deep Dive, etc.) */
  showType?: boolean
  type?: ContentItem["type"]
  /** Show category alongside type */
  showCategory?: boolean
  category?: CategoryRef
}

const { minutesRead, publishedOn, lastUpdatedOn, isDraft, class: className, showType, type, showCategory, category } = Astro.props as Props
const hasUpdates = lastUpdatedOn && publishedOn.toDateString() !== lastUpdatedOn.toDateString()
---

<div class:list={["frontmatter", className]}>
  {isDraft && <span class="badge">Draft</span>}

  {/* Type and Category together as breadcrumb-style */}
  {(showType || showCategory) && (
    <span class="frontmatter-item">
      {showType && type && (
        <span class="text-muted">{CONTENT_TYPE_LABELS[type]}</span>
      )}
      {showType && showCategory && category && (
        <span class="text-muted">/</span>
      )}
      {showCategory && category && (
        <Link href={category.href} class="frontmatter-link">{category.name}</Link>
      )}
    </span>
  )}

  <span class="frontmatter-item">
    <Icon name="carbon:time" class="icon-sm" />
    {minutesRead}
  </span>

  <span class="frontmatter-item" title="Published on">
    <Icon name="carbon:calendar" class="icon-sm" />
    <time datetime={publishedOn.toISOString()}>
      {
        publishedOn.toLocaleDateString("en-us", {
          year: "numeric",
          month: "short",
          day: "numeric",
        })
      }
    </time>
  </span>

  {
    hasUpdates && lastUpdatedOn && (
      <span class="frontmatter-item" title="Last Updated">
        <Icon name="carbon:update-now" class="icon-sm" />
        <time datetime={lastUpdatedOn.toISOString()}>
          {lastUpdatedOn.toLocaleDateString("en-us", {
            year: "numeric",
            month: "short",
            day: "numeric",
          })}
        </time>
      </span>
    )
  }
</div>
