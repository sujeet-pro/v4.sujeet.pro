---
interface CategoryArticle {
  id: string
  title: string
  href: string
}

interface Props {
  categoryName: string
  articles: CategoryArticle[]
  currentArticleId: string
  class?: string
}

const { categoryName, articles, currentArticleId, class: className } = Astro.props
---

<!-- Sidebar Category Nav (desktop only) -->
<div class:list={["category-nav-sidebar", className]} id="category-nav-sidebar">
  <h2 class="category-nav-heading">{categoryName}</h2>
  <nav class="category-nav-nav" aria-label={`${categoryName} articles`}>
    <ul class="category-nav-list">
      {
        articles.map((article) => {
          const isCurrent = article.id === currentArticleId
          return (
            <li class="category-nav-item">
              <a
                href={article.href}
                class:list={[
                  "category-nav-link",
                  { "category-nav-link-active": isCurrent }
                ]}
                aria-current={isCurrent ? "page" : undefined}
              >
                {article.title}
              </a>
            </li>
          )
        })
      }
    </ul>
  </nav>
</div>

<script>
  function initCategoryNav() {
    // Scroll to active item in sidebar on load
    const activeLink = document.querySelector("#category-nav-sidebar .category-nav-link-active")
    if (activeLink) {
      activeLink.scrollIntoView({
        behavior: "auto",
        block: "center",
      })
    }
  }

  // Initialize on DOM ready
  document.addEventListener("DOMContentLoaded", initCategoryNav)

  // Re-initialize on Astro page navigation (for View Transitions)
  document.addEventListener("astro:page-load", initCategoryNav)
</script>

<style is:global>
  @reference "tailwindcss";

  /* ==========================================================================
     SHARED CATEGORY NAV STYLES
     ========================================================================== */

  .category-nav-heading {
    @apply mb-4 text-sm font-medium uppercase tracking-wide opacity-60;
  }

  .category-nav-list {
    @apply space-y-1 text-sm;
  }

  .category-nav-item {
    @apply m-0;
  }

  .category-nav-link {
    @apply block rounded-md px-3 py-2;
    color: var(--color-text-muted);
    transition: all var(--transition-fast);
  }

  .category-nav-link:hover {
    background: var(--color-bg-alt);
    color: var(--color-text);
  }

  .category-nav-link-active {
    @apply font-medium rounded-none;
    border-left: 3px solid var(--color-accent);
    color: var(--color-accent) !important;
  }

  .category-nav-link-active:hover {
    background: transparent;
    color: var(--color-accent) !important;
  }

  /* ==========================================================================
     CATEGORY NAV SIDEBAR (Desktop - Left Sidebar)
     ========================================================================== */

  .category-nav-sidebar {
    @apply block;
  }

  /* Hide on mobile/tablet, show on desktop */
  @media (max-width: 1199px) {
    .category-nav-sidebar {
      @apply hidden;
    }
  }

  /* ==========================================================================
     CATEGORY NAV INLINE (Mobile/Tablet - Below Breadcrumb - Accordion)
     ========================================================================== */

  .category-nav-inline {
    @apply mb-6 hidden rounded-lg border;
    max-width: var(--content-width);
    background: var(--color-bg);
    border-color: var(--color-border);
  }

  /* Show on mobile/tablet, hide on desktop */
  @media (max-width: 1199px) {
    .category-nav-inline {
      @apply block;
    }
  }

  .category-nav-inline[open] {
    @apply shadow-md;
  }

  .category-nav-inline-summary {
    @apply flex cursor-pointer list-none items-center justify-between gap-3 px-4 py-3;
  }

  .category-nav-inline-summary::-webkit-details-marker {
    @apply hidden;
  }

  .category-nav-inline-title {
    @apply flex items-center gap-2 text-sm font-medium;
  }

  .category-nav-inline-icon {
    @apply h-5 w-5;
    color: var(--color-text-muted);
    transition: transform var(--transition-normal);
  }

  .category-nav-inline[open] .category-nav-inline-icon {
    transform: rotate(180deg);
  }

  .category-nav-inline-content {
    @apply max-h-96 overflow-y-auto;
    border-top: 1px solid var(--color-border);
  }

  .category-nav-inline-content .category-nav-list {
    @apply p-4;
  }
</style>
