---
import Link from "@/components/link.astro"
import { Icon } from "astro-icon/components"
---

<div class="search-container">
  <div class="relative w-full">
    <input type="text" id="search-input" placeholder="Search..." class="search-input" />
    <label for="search-input" class="search-icon-label">
      <Icon name="carbon:search" class="search-icon" />
    </label>
    <label for="search-input" class="search-kbd-label">
      <kbd class="search-kbd">
        <span class="text-xs">âŒ˜</span>
        <span class="ml-0.5">K</span>
      </kbd>
    </label>
  </div>
</div>

<style is:global>
  @reference "tailwindcss";

  .search-input {
    @apply w-full rounded-lg border px-4 py-2 text-sm;
    border-color: var(--color-border);
    padding-right: 3rem; /* 48px for kbd */
    padding-left: 2.5rem; /* 40px for icon */
  }

  .search-input:focus {
    outline: none;
    border-color: var(--color-accent);
  }

  .search-icon-label {
    @apply absolute top-1/2 left-3 -translate-y-1/2;
    pointer-events: none;
  }

  .search-icon {
    @apply h-4 w-4;
    color: var(--color-text-muted);
  }

  .search-kbd-label {
    @apply absolute top-1/2 right-3 -translate-y-1/2;
    pointer-events: none;
  }

  .search-kbd {
    @apply inline-flex items-center rounded border px-1.5 py-0.5 font-mono text-xs;
    border-color: var(--color-border);
    color: var(--color-text-muted);
  }
</style>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.querySelector<HTMLInputElement>("input#search-input")

    searchInput?.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const query = searchInput.value.trim()
        const searchUrl = new URL("/search", window.location.origin)
        if (query) {
          searchUrl.searchParams.set("q", query)
        }
        window.location.href = searchUrl.pathname + searchUrl.search
      }
    })

    document.addEventListener("keydown", (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === "k") {
        e.preventDefault()
        if (searchInput && searchInput.offsetParent !== null) {
          searchInput.focus()
        } else {
          window.location.href = "/search"
        }
      }
    })
  })
</script>
