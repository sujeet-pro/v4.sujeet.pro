---
/**
 * DocSearch Script Component
 *
 * Mounts Algolia DocSearch on #docsearch-container in the header.
 * The container markup lives in header.astro; this component wires up the JS.
 */
---

<script>
  import "@docsearch/css"
  import {
    PUBLIC_SUJEET_PRO_ALGOLIA_APP_ID,
    PUBLIC_SUJEET_PRO_ALGOLIA_API_KEY,
    PUBLIC_SUJEET_PRO_ALGOLIA_INDEX_NAME,
  } from "astro:env/client"

  // Expose public env vars for debugging (e.g. console: window.__env)
  ;(window as any).__env = {
    PUBLIC_SUJEET_PRO_ALGOLIA_APP_ID,
    PUBLIC_SUJEET_PRO_ALGOLIA_INDEX_NAME,
  }

  function initDocSearch() {
    const container = document.getElementById("docsearch-container")
    if (!container) return
    if (container.dataset.docsearchInit) return
    container.dataset.docsearchInit = "true"

    // Clear any previous content (View Transitions may preserve it)
    container.innerHTML = ""

    import("@docsearch/js").then(({ default: docsearch }) => {
      docsearch({
        appId: PUBLIC_SUJEET_PRO_ALGOLIA_APP_ID,
        apiKey: PUBLIC_SUJEET_PRO_ALGOLIA_API_KEY,
        indexName: PUBLIC_SUJEET_PRO_ALGOLIA_INDEX_NAME,
        container: "#docsearch-container",
      })
    })
  }

  initDocSearch()
  document.addEventListener("astro:page-load", initDocSearch)
</script>
