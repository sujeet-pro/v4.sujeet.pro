---
// Image Modal Component
// Allows clicking on images/SVGs in articles to view them in a zoomable modal
---

<!-- Image Modal -->
<div id="image-modal" class="image-modal" role="dialog" aria-modal="true" aria-label="Image viewer">
  <div class="image-modal-backdrop"></div>
  <div class="image-modal-content">
    <div class="image-modal-header">
      <div class="image-modal-controls">
        <button type="button" id="image-zoom-out" class="image-modal-btn" aria-label="Zoom out" title="Zoom out">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon-md"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            <line x1="8" y1="11" x2="14" y2="11"></line>
          </svg>
        </button>
        <span id="image-zoom-level" class="image-zoom-level">1.0X</span>
        <button type="button" id="image-zoom-in" class="image-modal-btn" aria-label="Zoom in" title="Zoom in">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon-md"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            <line x1="11" y1="8" x2="11" y2="14"></line>
            <line x1="8" y1="11" x2="14" y2="11"></line>
          </svg>
        </button>
        <button type="button" id="image-zoom-reset" class="image-modal-btn" aria-label="Reset zoom" title="Reset zoom">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon-md"
          >
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
            <path d="M3 3v5h5"></path>
          </svg>
        </button>
      </div>
      <button
        type="button"
        id="image-modal-close"
        class="image-modal-btn image-modal-close"
        aria-label="Close image viewer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="icon-md"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="image-modal-body" id="image-modal-body">
      <!-- Cloned image will be inserted here -->
    </div>
  </div>
</div>

<script>
  import { initImageModal } from "@/scripts/image-modal"
  document.addEventListener("DOMContentLoaded", initImageModal)
  document.addEventListener("astro:page-load", initImageModal)
</script>

<style is:global>
  @reference "tailwindcss";

  .image-modal {
    @apply fixed inset-0 z-60 hidden;
  }

  .image-modal.open {
    @apply flex flex-col;
  }

  .image-modal-backdrop {
    @apply absolute inset-0;
    background-color: rgb(0 0 0 / 0.9);
  }

  .image-modal-content {
    @apply relative flex h-full w-full flex-col;
  }

  .image-modal-header {
    @apply relative z-10 flex items-center justify-between px-4 py-3;
    background: rgb(0 0 0 / 0.5);
  }

  .image-modal-controls {
    @apply flex items-center gap-2;
  }

  .image-modal-btn {
    @apply flex cursor-pointer items-center justify-center rounded-md border-none bg-transparent p-2;
    color: #ffffff;
    min-width: var(--min-touch-target);
    min-height: var(--min-touch-target);
    transition: background-color var(--transition-fast);
  }

  .image-modal-btn:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .image-modal-btn:focus {
    @apply outline-2 outline-offset-2;
    outline-color: #ffffff;
  }

  .image-zoom-level {
    @apply min-w-16 text-center text-sm;
    color: #ffffff;
    font-variant-numeric: tabular-nums;
  }

  .image-modal-body {
    @apply flex flex-1 items-start justify-start overflow-auto p-4;
  }

  .image-modal-body .image-modal-image {
    @apply select-none;
    touch-action: none;
    transition: transform var(--transition-fast);
    transform-origin: center;
  }

  .image-modal-body svg.image-modal-image {
    @apply h-auto w-auto rounded-lg bg-white p-4;
    max-width: none;
    max-height: none;
    transform-box: fill-box;
  }
</style>
