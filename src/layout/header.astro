---
import MobileMenu from "./mobile-menu.astro"
import Link from "@/components/ui/link.astro"
import { getNavItems } from "@/utils/site.utils"
import { Icon } from "astro-icon/components"

interface Props {
  hasLeftSidebar?: boolean
  hasRightSidebar?: boolean
}

const { hasLeftSidebar = false, hasRightSidebar = false } = Astro.props
const navItems = await getNavItems()
---

<header class="site-header">
  <div class="header-container">
    <nav class="header-nav">
      <!-- Left side: sidebar toggle + logo -->
      <div class="header-left">
        {
          hasLeftSidebar && (
            <button
              id="left-sidebar-toggle"
              class="sidebar-toggle-btn"
              aria-label="Toggle navigation sidebar"
              aria-expanded="true"
              title="Hide navigation sidebar"
            >
              <Icon name="carbon:side-panel-open" class="icon-md" />
            </button>
          )
        }
        <Link href="/" class="header-logo">
          <span class="header-logo-name">sujeet.pro</span>
        </Link>
      </div>

      <!-- Center: Nav links - hidden on mobile -->
      <div class="header-nav-links">
        {
          navItems.map((item) => (
            <Link href={item.path} class="nav-link">
              {item.label}
            </Link>
          ))
        }
      </div>

      <!-- Right side: search + sidebar toggle + hamburger -->
      <div class="header-actions">
        <!-- DocSearch -->
        <div id="docsearch-container"></div>

        <!-- Theme Toggle -->
        <button id="theme-toggle-btn" class="sidebar-toggle-btn" aria-label="Toggle theme" title="Switch theme">
          <!-- Auto (monitor) -->
          <svg
            data-theme-icon="auto"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 32 32"
            fill="currentColor"
            class="icon-md"
            style="display:none"
          >
            <path
              d="M28 4H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h8v4H8v2h16v-2h-4v-4h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm0 18H4V6h24Z"
            ></path>
          </svg>
          <!-- Light (sun) -->
          <svg
            data-theme-icon="light"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 32 32"
            fill="currentColor"
            class="icon-md"
            style="display:none"
          >
            <path
              d="M16 12.005a4 4 0 1 1-4 4 4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6 6 6 0 0 0-6-6ZM5.394 6.813 6.81 5.399l3.505 3.506L8.9 10.319ZM2 15.005h5v2H2ZM5.394 25.197l3.505-3.506 1.414 1.414-3.505 3.506ZM15 25.005h2v5h-2ZM21.687 23.106l1.414-1.414 3.506 3.505-1.414 1.414ZM25 15.005h5v2h-5ZM21.69 8.904l3.505-3.505 1.414 1.415-3.505 3.505ZM15 2.005h2v5h-2Z"
            ></path>
          </svg>
          <!-- Dark (moon) -->
          <svg
            data-theme-icon="dark"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 32 32"
            fill="currentColor"
            class="icon-md"
            style="display:none"
          >
            <path
              d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194 11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016 13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555 1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38 1.015 1.015 0 0 0 14.98 3Z"
            ></path>
          </svg>
          <!-- High contrast light -->
          <svg
            data-theme-icon="high-contrast-light"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 32 32"
            fill="currentColor"
            class="icon-md"
            style="display:none"
          >
            <path d="M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2Zm0 26V4a12 12 0 0 1 0 24Z"></path>
          </svg>
          <!-- High contrast dark -->
          <svg
            data-theme-icon="high-contrast-dark"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 32 32"
            fill="currentColor"
            class="icon-md"
            style="display:none"
          >
            <path d="M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2Zm0 2a12 12 0 0 1 0 24Z"></path>
          </svg>
          <!-- Paper (document) -->
          <svg
            data-theme-icon="paper"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 32 32"
            fill="currentColor"
            class="icon-md"
            style="display:none"
          >
            <path d="M19 10h7v2h-7zM19 6h7v2h-7zM19 14h7v2h-7zM19 18h7v2h-7z"></path>
            <path
              d="M28 2H10a2.002 2.002 0 0 0-2 2v6H4a2.002 2.002 0 0 0-2 2v18a2 2 0 0 0 2 2h14a2.002 2.002 0 0 0 2-2v-6h8a2.002 2.002 0 0 0 2-2V4a2.002 2.002 0 0 0-2-2Zm-10 28H4V12h14Zm10-8H20V12a2.002 2.002 0 0 0-2-2h-8V4h18Z"
            ></path>
            <path d="M6 16h10v2H6zM6 20h10v2H6zM6 24h7v2H6z"></path>
          </svg>
        </button>

        {
          hasRightSidebar && (
            <button
              id="right-sidebar-toggle"
              class="sidebar-toggle-btn"
              aria-label="Toggle table of contents"
              aria-expanded="true"
              title="Hide table of contents"
            >
              <Icon name="carbon:side-panel-close" class="icon-md" />
            </button>
          )
        }

        <!-- Hamburger Menu - visible on mobile only -->
        <button
          id="mobile-menu-btn"
          class="mobile-menu-btn"
          aria-label="Open menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
          title="Open menu"
        >
          <Icon name="carbon:menu" class="icon-lg" />
        </button>
      </div>
    </nav>
  </div>
</header>

<MobileMenu />

<style is:global>
  @reference "tailwindcss";

  .header-container {
    @apply mx-auto w-full px-5 md:px-8;
    max-width: var(--header-width);
  }

  .header-nav {
    @apply flex items-center justify-between gap-6;
    height: var(--header-height);
  }

  .header-left {
    @apply flex items-center gap-2;
  }

  .header-logo {
    @apply no-underline;
  }

  .header-logo-name {
    @apply font-mono text-sm lowercase;
    color: var(--color-text);
    letter-spacing: 0.02em;
    transition: color var(--transition-fast);
  }

  .header-logo:hover .header-logo-name {
    color: var(--color-text-muted);
  }

  .header-nav-links {
    @apply hidden items-center gap-8 md:flex;
  }

  .header-actions {
    @apply flex items-center gap-2;
  }

  /* Sidebar toggles - visible on all screen sizes */
  .sidebar-toggle-btn {
    @apply flex;
  }

  .sidebar-toggle-btn .icon-md {
    transition: transform var(--transition-fast);
  }

  /* Flip arrow when sidebar is open */
  .sidebar-toggle-btn[aria-expanded="true"] .icon-md {
    transform: scaleX(-1);
  }
</style>
