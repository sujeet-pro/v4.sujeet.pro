---
import Search from "./search.astro"
import Link from "@/components/link.astro"
import { NAV_ITEMS } from "@constants/site"
import { Icon } from "astro-icon/components"
---

<header class="site-header">
  <div class="content-container">
    <nav class="site-nav">
      <!-- Logo -->
      <Link href="/" class="nav-link text-xl font-semibold"> sujeet.pro </Link>

      <!-- Desktop Navigation -->
      <div class="hidden items-center gap-4 lg:flex">
        {
          NAV_ITEMS.map((item) => (
            <Link href={item.path} class="nav-link">
              {item.label}
            </Link>
          ))
        }
        <Search />
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="flex items-center p-2 lg:hidden"
        aria-label="Open menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <Icon name="carbon:menu" class="h-6 w-6" />
      </button>
    </nav>
  </div>
</header>

<!-- Mobile Sidebar -->
<div id="mobile-menu-overlay" class="mobile-menu-overlay hidden"></div>
<aside id="mobile-menu" class="mobile-menu" aria-hidden="true">
  <div class="mobile-menu-header">
    <Link href="/" class="nav-link text-xl font-semibold"> sujeet.pro </Link>
    <button id="mobile-menu-close" class="p-2" aria-label="Close menu">
      <Icon name="carbon:close" class="h-6 w-6" />
    </button>
  </div>
  <nav class="mobile-menu-nav">
    {
      NAV_ITEMS.map((item) => (
        <Link href={item.path} class="mobile-menu-link">
          {item.label}
        </Link>
      ))
    }
    <Link href="/search" class="mobile-menu-link mobile-menu-search">
      <Icon name="carbon:search" class="h-5 w-5" />
      <span>Search</span>
    </Link>
  </nav>
</aside>

<script>
  function initMobileMenu() {
    const menuBtn = document.getElementById("mobile-menu-btn")
    const closeBtn = document.getElementById("mobile-menu-close")
    const overlay = document.getElementById("mobile-menu-overlay")
    const menu = document.getElementById("mobile-menu")

    function openMenu() {
      menu?.classList.add("open")
      overlay?.classList.remove("hidden")
      menuBtn?.setAttribute("aria-expanded", "true")
      menu?.setAttribute("aria-hidden", "false")
      document.body.style.overflow = "hidden"
    }

    function closeMenu() {
      menu?.classList.remove("open")
      overlay?.classList.add("hidden")
      menuBtn?.setAttribute("aria-expanded", "false")
      menu?.setAttribute("aria-hidden", "true")
      document.body.style.overflow = ""
    }

    menuBtn?.addEventListener("click", openMenu)
    closeBtn?.addEventListener("click", closeMenu)
    overlay?.addEventListener("click", closeMenu)

    // Close menu on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && menu?.classList.contains("open")) {
        closeMenu()
      }
    })

    // Close menu when clicking a link
    menu?.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", closeMenu)
    })
  }

  document.addEventListener("DOMContentLoaded", initMobileMenu)
  document.addEventListener("astro:page-load", initMobileMenu)
</script>

<style>
  /* Mobile menu overlay */
  .mobile-menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 100;
  }

  /* Mobile menu sidebar */
  .mobile-menu {
    position: fixed;
    top: 0;
    right: 0;
    width: 280px;
    max-width: 80vw;
    height: 100vh;
    background: var(--color-bg);
    z-index: 101;
    transform: translateX(100%);
    transition: transform 200ms ease;
    display: flex;
    flex-direction: column;
  }

  .mobile-menu.open {
    transform: translateX(0);
  }

  .mobile-menu-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-menu-nav {
    display: flex;
    flex-direction: column;
    padding: 1rem 0;
    flex: 1;
    overflow-y: auto;
  }

  .mobile-menu-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.875rem 1.5rem;
    color: var(--color-text);
    text-decoration: none;
    font-size: 1rem;
    transition: background-color 150ms ease;
  }

  .mobile-menu-link:hover {
    background: var(--color-bg-alt);
  }

  .mobile-menu-search {
    margin-top: auto;
    border-top: 1px solid var(--color-border);
    padding-top: 1rem;
  }
</style>
