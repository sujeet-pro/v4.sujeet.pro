---
import Search from "./search.astro"
import Link from "@/components/link.astro"
import { NAV_ITEMS } from "@constants/site"
import { Icon } from "astro-icon/components"
---

<header class="site-header">
  <div class="content-container">
    <nav class="site-nav">
      <!-- Logo - always visible -->
      <Link href="/" class="nav-link nav-logo"> sujeet.pro </Link>

      <!-- Nav Links - visible on sm and above -->
      <div class="nav-links-container">
        {
          NAV_ITEMS.map((item) => (
            <Link href={item.path} class="nav-link">
              {item.label}
            </Link>
          ))
        }
      </div>

      <!-- Search Icon - visible on sm only -->
      <Link href="/search" class="nav-search-icon" aria-label="Search">
        <Icon name="carbon:search" class="icon-lg" />
      </Link>

      <!-- Search Input - visible on md and above -->
      <div class="nav-search-input">
        <Search />
      </div>

      <!-- Hamburger Menu - visible on default only (below sm) -->
      <button
        id="mobile-menu-btn"
        class="mobile-menu-btn"
        aria-label="Open menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <Icon name="carbon:menu" class="icon-lg" />
      </button>
    </nav>
  </div>
</header>

<!-- Mobile Sidebar -->
<div id="mobile-menu-overlay" class="mobile-menu-overlay is-hidden"></div>
<aside id="mobile-menu" class="mobile-menu" aria-hidden="true">
  <div class="mobile-menu-header">
    <Link href="/" class="nav-link nav-logo"> sujeet.pro </Link>
    <button id="mobile-menu-close" class="mobile-menu-close" aria-label="Close menu">
      <Icon name="carbon:close" class="icon-lg" />
    </button>
  </div>
  <nav class="mobile-menu-nav">
    {
      NAV_ITEMS.map((item) => (
        <Link href={item.path} class="mobile-menu-link">
          {item.label}
        </Link>
      ))
    }
    <Link href="/search" class="mobile-menu-link mobile-menu-link--search">
      <Icon name="carbon:search" class="icon-md" />
      <span>Search</span>
    </Link>
  </nav>
</aside>

<script>
  function initMobileMenu() {
    const menuBtn = document.getElementById("mobile-menu-btn")
    const closeBtn = document.getElementById("mobile-menu-close")
    const overlay = document.getElementById("mobile-menu-overlay")
    const menu = document.getElementById("mobile-menu")

    function openMenu() {
      menu?.classList.add("is-open")
      overlay?.classList.remove("is-hidden")
      menuBtn?.setAttribute("aria-expanded", "true")
      menu?.setAttribute("aria-hidden", "false")
      document.body.style.overflow = "hidden"
    }

    function closeMenu() {
      menu?.classList.remove("is-open")
      overlay?.classList.add("is-hidden")
      menuBtn?.setAttribute("aria-expanded", "false")
      menu?.setAttribute("aria-hidden", "true")
      document.body.style.overflow = ""
    }

    menuBtn?.addEventListener("click", openMenu)
    closeBtn?.addEventListener("click", closeMenu)
    overlay?.addEventListener("click", closeMenu)

    // Close menu on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && menu?.classList.contains("is-open")) {
        closeMenu()
      }
    })

    // Close menu when clicking a link
    menu?.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", closeMenu)
    })
  }

  document.addEventListener("DOMContentLoaded", initMobileMenu)
  document.addEventListener("astro:page-load", initMobileMenu)
</script>
