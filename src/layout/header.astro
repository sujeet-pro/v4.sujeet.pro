---
import Search from "./search.astro"
import Link from "@/components/link.astro"
import { getNavItems } from "@/utils/site.utils"
import { Icon } from "astro-icon/components"

const navItems = await getNavItems()
---

<header class="site-header">
  <div class="header-container">
    <nav class="header-nav">
      <!-- Logo - left on mobile, in grid on desktop -->
      <Link href="/" class="header-logo">
        <span class="header-logo-name">sujeet.pro</span>
      </Link>

      <!-- Nav links - hidden on mobile -->
      <div class="header-nav-links">
        {
          navItems.map((item) => (
            <Link href={item.path} class="nav-link">
              {item.label}
            </Link>
          ))
        }
      </div>

      <!-- Search and hamburger -->
      <div class="header-actions">
        <!-- Search Icon - visible on sm only -->
        <Link href="/search" class="nav-search-icon" aria-label="Search">
          <Icon name="carbon:search" class="icon-md" />
        </Link>

        <!-- Search Input - visible on md and above -->
        <div class="nav-search-input">
          <Search />
        </div>

        <!-- Hamburger Menu - visible on mobile only -->
        <button
          id="mobile-menu-btn"
          class="mobile-menu-btn"
          aria-label="Open menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <Icon name="carbon:menu" class="icon-lg" />
        </button>
      </div>
    </nav>
  </div>
</header>

<!-- Mobile Sidebar -->
<div id="mobile-menu-overlay" class="mobile-menu-overlay is-hidden"></div>
<aside id="mobile-menu" class="mobile-menu" aria-hidden="true">
  <div class="mobile-menu-header">
    <Link href="/" class="nav-link nav-logo"> sujeet.pro </Link>
    <button id="mobile-menu-close" class="mobile-menu-close" aria-label="Close menu">
      <Icon name="carbon:close" class="icon-lg" />
    </button>
  </div>
  <nav class="mobile-menu-nav">
    {
      navItems.map((item) => (
        <Link href={item.path} class="mobile-menu-link">
          {item.label}
        </Link>
      ))
    }
    <Link href="/search" class="mobile-menu-link mobile-menu-link--search">
      <Icon name="carbon:search" class="icon-md" />
      <span>Search</span>
    </Link>
  </nav>
</aside>

<script>
  function initMobileMenu() {
    const menuBtn = document.getElementById("mobile-menu-btn")
    const closeBtn = document.getElementById("mobile-menu-close")
    const overlay = document.getElementById("mobile-menu-overlay")
    const menu = document.getElementById("mobile-menu")

    function openMenu() {
      menu?.classList.add("is-open")
      overlay?.classList.remove("is-hidden")
      menuBtn?.setAttribute("aria-expanded", "true")
      menu?.setAttribute("aria-hidden", "false")
      document.body.style.overflow = "hidden"
    }

    function closeMenu() {
      menu?.classList.remove("is-open")
      overlay?.classList.add("is-hidden")
      menuBtn?.setAttribute("aria-expanded", "false")
      menu?.setAttribute("aria-hidden", "true")
      document.body.style.overflow = ""
    }

    menuBtn?.addEventListener("click", openMenu)
    closeBtn?.addEventListener("click", closeMenu)
    overlay?.addEventListener("click", closeMenu)

    // Close menu on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && menu?.classList.contains("is-open")) {
        closeMenu()
      }
    })

    // Close menu when clicking a link
    menu?.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", closeMenu)
    })
  }

  document.addEventListener("DOMContentLoaded", initMobileMenu)
  document.addEventListener("astro:page-load", initMobileMenu)
</script>

<style is:global>
  @reference "tailwindcss";

  /* Header container */
  .header-container {
    @apply mx-auto w-full px-5 md:px-8;
    max-width: var(--header-width);
  }

  /* Header nav - flexbox layout */
  .header-nav {
    @apply flex items-center justify-between gap-6 py-4;
  }

  /* Logo */
  .header-logo {
    @apply no-underline;
  }

  .header-logo-name {
    @apply text-xl font-semibold;
    color: var(--color-text);
    letter-spacing: -0.02em;
    transition: color var(--transition-fast);
  }

  .header-logo:hover .header-logo-name {
    color: var(--color-accent);
  }

  /* Nav links - center, hidden on mobile */
  .header-nav-links {
    @apply hidden items-center gap-8 md:flex;
  }

  /* Header actions - right side */
  .header-actions {
    @apply flex items-center gap-2;
  }
</style>
